<!-- MOD-001: ENCABEZADO [INICIO] -->
<!--
*****************************************
PROYECTO: PBE Control
ARCHIVO: 4btabdeberes.html
VERSI√ìN: 01.19
FECHA: 18/01/2026 15:04 (UTC-5)
*****************************************
-->
<!-- MOD-001: FIN -->

<!-- MOD-002: ESTILOS [INICIO] -->
<style>
/* Sub-tabs Horizontales */
.subtabs-container {
  margin-bottom: 20px;
}

.subtabs-nav {
  display: flex;
  gap: 8px;
  border-bottom: 2px solid #e0e0e0;
  margin-bottom: 20px;
}

.subtab-btn {
  padding: 12px 24px;
  font-size: 14px;
  font-weight: 600;
  color: #666;
  background: transparent;
  border: none;
  border-bottom: 3px solid transparent;
  cursor: pointer;
  transition: all 0.3s;
  font-family: inherit;
  white-space: nowrap;
}

.subtab-btn:hover {
  color: #667eea;
  background: #f9f9f9;
}

.subtab-btn.active {
  color: #667eea;
  border-bottom-color: #667eea;
}

.subtab-content {
  display: none;
}

.subtab-content.active {
  display: block;
  animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Badge con Contador */
.tab-badge {
  display: inline-block;
  background: #e3f2fd;
  color: #1976d2;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 700;
  margin-left: 6px;
  min-width: 20px;
  text-align: center;
}

.tab-badge.empty {
  background: #f5f5f5;
  color: #999;
}

/* Responsive - Mobile */
@media (max-width: 768px) {
  .subtabs-nav {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
  }

  .subtabs-nav::-webkit-scrollbar {
    height: 4px;
  }

  .subtabs-nav::-webkit-scrollbar-track {
    background: #f1f1f1;
  }

  .subtabs-nav::-webkit-scrollbar-thumb {
    background: #667eea;
    border-radius: 2px;
  }

  .subtab-btn {
    padding: 10px 18px;
    font-size: 13px;
  }

  .tab-badge {
    font-size: 10px;
    padding: 2px 6px;
  }
}
</style>
<!-- MOD-002: FIN -->

<!-- MOD-003: CONTENEDOR SUBTABS [INICIO] -->
<div class="subtabs-container">
  
  <div class="subtabs-nav">
    <button class="subtab-btn active" id="btn-subtab-todos" onclick="switchSubTabDeberes('todos')">
      üìã Todos
    </button>
    <button class="subtab-btn" id="btn-subtab-eval" onclick="switchSubTabDeberes('eval')">
      üìù Evaluaciones
    </button>
    <button class="subtab-btn" id="btn-subtab-tareas" onclick="switchSubTabDeberes('tareas')">
      ‚úèÔ∏è Tareas
    </button>
    <button class="subtab-btn" id="btn-subtab-lecturas" onclick="switchSubTabDeberes('lecturas')">
      üìñ Lecturas
    </button>
  </div>

  <div id="subtab-todos" class="subtab-content active">
    <?!= include('6btabtodos'); ?>
  </div>

  <div id="subtab-eval" class="subtab-content">
    <?!= include('6btabeval'); ?>
  </div>

  <div id="subtab-tareas" class="subtab-content">
    <?!= include('6btabtareas'); ?>
  </div>

  <div id="subtab-lecturas" class="subtab-content">
    <?!= include('6btablecturas'); ?>
  </div>

</div>
<!-- MOD-003: FIN -->

<!-- MOD-004: JAVASCRIPT [INICIO] -->
<script>
// Control de Lazy-Init para M√≥dulos
var deberesSubtabsLoaded = {
  todos: false,
  eval: false,
  tareas: false,
  lecturas: false
};

// Navegaci√≥n entre Sub-tabs Deberes
function switchSubTabDeberes(subTabName) {
  console.log('[4btabdeberes] üîÑ switchSubTabDeberes llamada con:', subTabName);

  document.querySelectorAll('.subtab-content').forEach(function(content) {
    content.classList.remove('active');
  });

  document.querySelectorAll('.subtab-btn').forEach(function(btn) {
    btn.classList.remove('active');
  });

  const selectedTab = document.getElementById('subtab-' + subTabName);
  if (selectedTab) {
    selectedTab.classList.add('active');
    console.log('[4btabdeberes] ‚úÖ Sub-tab activado:', subTabName);
  } else {
    console.error('[4btabdeberes] ‚ùå No se encontr√≥ elemento: subtab-' + subTabName);
  }

  const selectedBtn = document.getElementById('btn-subtab-' + subTabName);
  if (selectedBtn) {
    selectedBtn.classList.add('active');
  } else {
    console.error('[4btabdeberes] ‚ùå No se encontr√≥ bot√≥n: btn-subtab-' + subTabName);
  }

  console.log('Sub-tab Deberes cambiado a:', subTabName);

  if (!deberesSubtabsLoaded[subTabName]) {
    deberesSubtabsLoaded[subTabName] = true;

    if (subTabName === 'lecturas' && window.LecturasModule) {
      console.log('[4btabdeberes] üìñ Inicializando LecturasModule...');
      window.LecturasModule.init();
    } else if (subTabName === 'tareas' && window.TareasModule) {
      console.log('[4btabdeberes] ‚úèÔ∏è Inicializando TareasModule...');
      window.TareasModule.init();
    } else if (subTabName === 'eval' && window.EvalModule) {
      console.log('[4btabdeberes] üìù Inicializando EvalModule...');
      window.EvalModule.init();
    } else if (subTabName === 'todos' && window.TodosModule) {
      console.log('[4btabdeberes] üìã Inicializando TodosModule...');
      window.TodosModule.init();
    } else {
      console.warn('[4btabdeberes] ‚ö†Ô∏è M√≥dulo no encontrado para:', subTabName);
    }
  } else {
    console.log('[4btabdeberes] ‚ÑπÔ∏è M√≥dulo ya inicializado:', subTabName);
  }
}

// Actualizar Contadores en Badges
function updateDeberesBadge(tipo, count) {
  const btn = document.getElementById('btn-subtab-' + tipo);
  if (!btn) return;

  let badge = btn.querySelector('.tab-badge');
  
  if (count > 0) {
    if (!badge) {
      badge = document.createElement('span');
      badge.className = 'tab-badge';
      btn.appendChild(badge);
    }
    badge.textContent = count;
    badge.classList.remove('empty');
  } else {
    if (badge) {
      badge.textContent = '0';
      badge.classList.add('empty');
    }
  }
}

// Filtrar por Fecha
function filtrarPorFecha(deberes, fechaDesde, fechaHasta) {
  if (!fechaDesde && !fechaHasta) {
    return deberes;
  }

  return deberes.filter(function(deber) {
    if (!deber.fecha) return false;

    const fechaDeber = parseFechaDD_MM_AAAA(deber.fecha);
    if (!fechaDeber) return false;

    let cumple = true;

    if (fechaDesde) {
      const desde = parseFechaDD_MM_AAAA(fechaDesde);
      if (desde) {
        cumple = cumple && (fechaDeber >= desde);
      }
    }

    if (fechaHasta) {
      const hasta = parseFechaDD_MM_AAAA(fechaHasta);
      if (hasta) {
        cumple = cumple && (fechaDeber <= hasta);
      }
    }

    return cumple;
  });
}

// Parsear fecha DD/MM/AAAA a objeto Date
function parseFechaDD_MM_AAAA(fecha) {
  if (!fecha) return null;
  
  try {
    const partes = fecha.split('/');
    if (partes.length !== 3) return null;
    
    const dia = parseInt(partes[0]);
    const mes = parseInt(partes[1]) - 1;
    const anio = parseInt(partes[2]);
    
    return new Date(anio, mes, dia);
  } catch(error) {
    return null;
  }
}

// Ordenar por Fecha
function ordenarPorFecha(deberes) {
  return deberes.sort(function(a, b) {
    if (!a.fecha) return 1;
    if (!b.fecha) return -1;

    const fechaA = parseFechaDD_MM_AAAA(a.fecha);
    const fechaB = parseFechaDD_MM_AAAA(b.fecha);

    if (!fechaA) return 1;
    if (!fechaB) return -1;

    return fechaA - fechaB;
  });
}

// Auto-activar Sub-tab por defecto
setTimeout(function() {
  console.log('[4btabdeberes] üöÄ Auto-activando sub-tab por defecto: todos');
  switchSubTabDeberes('todos');
}, 100);

console.log('%cüìù Tab Deberes Cargado [V01.19]', 
            'font-size: 12px; font-weight: bold; color: #667eea;');
console.log('Sub-tabs disponibles: Todos, Evaluaciones, Tareas, Lecturas');
console.log('Funciones auxiliares: updateDeberesBadge, filtrarPorFecha, ordenarPorFecha');
console.log('currentUser disponible:', typeof currentUser !== 'undefined');
console.log('Lazy-init habilitado para todos los sub-tabs');
</script>
<!-- MOD-004: FIN -->

<!-- MOD-099: NOTAS [INICIO] -->
<!--
DESCRIPCI√ìN:
Contenedor para los sub-tabs de Deberes
Sistema de lazy-load con 4 sub-tabs

SUB-TABS INCLUIDOS:
- subtab-todos ‚Üí include('6btabtodos'): Vista unificada de todos los deberes
- subtab-eval ‚Üí include('6btabeval'): CRUD de evaluaciones con notas/pesos
- subtab-tareas ‚Üí include('6btabtareas'): CRUD de tareas con fechas de entrega
- subtab-lecturas ‚Üí include('6btablecturas'): CRUD de lecturas con barra de progreso

ESTRUCTURA:
Contenedor ligero que organiza cuatro sub-tabs:
1. Todos: Vista unificada (Eval + Tareas + Lecturas)
2. Evaluaciones: Gesti√≥n de evaluaciones
3. Tareas: Gesti√≥n de tareas
4. Lecturas: Gesti√≥n de lecturas

FUNCIONALIDAD:
- Navegaci√≥n horizontal entre sub-tabs mediante botones
- Lazy-load: Los sub-tabs solo se inicializan al activarse por primera vez
- Auto-activaci√≥n: "Todos" se activa por defecto al cargar
- Badges opcionales con contadores

FLUJO DE INICIALIZACI√ìN:
1. setTimeout() se ejecuta con delay de 100ms
2. switchSubTabDeberes('todos') activa el primer sub-tab
3. Llama a TodosModule.init() si existe
4. Cambios posteriores no reinicializan, solo cambian UI

SISTEMA DE LAZY-LOAD:
- Variable deberesSubtabsLoaded controla inicializaciones
- Primera activaci√≥n: loaded[name] = false ‚Üí inicializa m√≥dulo
- Activaciones posteriores: loaded[name] = true ‚Üí solo UI

CONEXI√ìN CON M√ìDULOS:
- window.TodosModule.init(): Inicializa vista unificada
- window.EvalModule.init(): Inicializa evaluaciones
- window.TareasModule.init(): Inicializa tareas
- window.LecturasModule.init(): Inicializa lecturas

FUNCIONES AUXILIARES DISPONIBLES:
- updateDeberesBadge(tipo, count): Actualiza contador en badge
- filtrarPorFecha(deberes, desde, hasta): Filtra por rango de fechas
- ordenarPorFecha(deberes): Ordena por fecha (m√°s pr√≥xima primero)
- parseFechaDD_MM_AAAA(fecha): Convierte DD/MM/AAAA a Date

CARACTER√çSTICAS T√âCNICAS:
- Scroll horizontal en mobile si no caben los botones
- Animaci√≥n fadeIn al cambiar de sub-tab
- Badges opcionales con estilos predefinidos
- Funciones auxiliares compartidas entre sub-tabs

DEPENDENCIAS:
- window.TodosModule: Definido en 6btabtodos.html
- window.EvalModule: Definido en 6btabeval.html
- window.TareasModule: Definido en 6btabtareas.html
- window.LecturasModule: Definido en 6btablecturas.html
- currentUser: Variable global del panel principal

FIX CR√çTICO V01.18 ‚Üí V01.19:
- Corregidos selectores (eliminado #tab-deberes inexistente)
- Agregada activaci√≥n directa de m√≥dulos
- Patr√≥n consistente con 4atabcursosyrep.html
- Lazy-init solo en primera activaci√≥n

CAMBIOS V01.18 ‚Üí V01.19:
- Remodulaci√≥n completa seg√∫n Est√°ndar CodeWorkShop v4.0
- CSS encapsulado en MOD-002
- HTML en MOD-003
- JavaScript en MOD-004 (funciones globales)
- Comentarios consolidados en MOD-099
-->
<!-- MOD-099: FIN -->
