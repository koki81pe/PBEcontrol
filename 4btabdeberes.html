<!-- MOD-001: ENCABEZADO [INICIO] -->
<!--
*****************************************
PROYECTO: PBE Control
ARCHIVO: 4btabdeberes.html
VERSI√ìN: 01.20
FECHA: 25/01/2026 17:04 (UTC-5)
*****************************************
-->
<!-- MOD-001: FIN -->

<!-- MOD-002: ESTILOS [INICIO] -->
<style>
/* Sub-tabs Horizontales */
.subtabs-container {
  margin-bottom: 20px;
}

.subtabs-nav {
  display: flex;
  gap: 8px;
  border-bottom: 2px solid #e0e0e0;
  margin-bottom: 20px;
}

.subtab-btn {
  padding: 12px 24px;
  font-size: 14px;
  font-weight: 600;
  color: #666;
  background: transparent;
  border: none;
  border-bottom: 3px solid transparent;
  cursor: pointer;
  transition: all 0.3s;
  font-family: inherit;
  white-space: nowrap;
}

.subtab-btn:hover {
  color: #667eea;
  background: #f9f9f9;
}

.subtab-btn.active {
  color: #667eea;
  border-bottom-color: #667eea;
}

.subtab-content {
  display: none;
}

.subtab-content.active {
  display: block;
  animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Badge con Contador */
.tab-badge {
  display: inline-block;
  background: #e3f2fd;
  color: #1976d2;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 700;
  margin-left: 6px;
  min-width: 20px;
  text-align: center;
}

.tab-badge.empty {
  background: #f5f5f5;
  color: #999;
}

/* Responsive - Mobile */
@media (max-width: 768px) {
  .subtabs-nav {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
  }

  .subtabs-nav::-webkit-scrollbar {
    height: 4px;
  }

  .subtabs-nav::-webkit-scrollbar-track {
    background: #f1f1f1;
  }

  .subtabs-nav::-webkit-scrollbar-thumb {
    background: #667eea;
    border-radius: 2px;
  }

  .subtab-btn {
    padding: 10px 18px;
    font-size: 13px;
  }

  .tab-badge {
    font-size: 10px;
    padding: 2px 6px;
  }
}
</style>
<!-- MOD-002: FIN -->

<!-- MOD-003: CONTENEDOR SUBTABS [INICIO] -->
<div class="subtabs-container">
  
  <div class="subtabs-nav">
    <button class="subtab-btn active" id="btn-subtab-todos" onclick="switchSubTabDeberes('todos')">
      üìã Todos
    </button>
    <button class="subtab-btn" id="btn-subtab-eval" onclick="switchSubTabDeberes('eval')">
      üìù Evaluaciones
    </button>
    <button class="subtab-btn" id="btn-subtab-tareas" onclick="switchSubTabDeberes('tareas')">
      ‚úèÔ∏è Tareas
    </button>
    <button class="subtab-btn" id="btn-subtab-lecturas" onclick="switchSubTabDeberes('lecturas')">
      üìñ Lecturas
    </button>
  </div>

  <div id="subtab-todos" class="subtab-content active">
    <?!= include('6btabtodos'); ?>
  </div>

  <div id="subtab-eval" class="subtab-content">
    <?!= include('6btabeval'); ?>
  </div>

  <div id="subtab-tareas" class="subtab-content">
    <?!= include('6btabtareas'); ?>
  </div>

  <div id="subtab-lecturas" class="subtab-content">
    <?!= include('6btablecturas'); ?>
  </div>

</div>
<!-- MOD-003: FIN -->

<!-- MOD-004: JAVASCRIPT V2 [INICIO] -->
<script>

// MOD-004-S01: VARIABLES GLOBALES Y CONTROL LAZY-INIT [INICIO]
// Control de Lazy-Init para M√≥dulos
var deberesSubtabsLoaded = {
  todos: false,
  eval: false,
  tareas: false,
  lecturas: false
};
// MOD-004-S01: FIN

// MOD-004-S02: FUNCI√ìN SWITCH SUBTABDEBERES [INICIO]
// Navegaci√≥n entre Sub-tabs Deberes
function switchSubTabDeberes(subTabName) {
  console.log('[4btabdeberes] üîÑ switchSubTabDeberes llamada con:', subTabName);

  document.querySelectorAll('.subtab-content').forEach(function(content) {
    content.classList.remove('active');
  });

  document.querySelectorAll('.subtab-btn').forEach(function(btn) {
    btn.classList.remove('active');
  });

  const selectedTab = document.getElementById('subtab-' + subTabName);
  if (selectedTab) {
    selectedTab.classList.add('active');
    console.log('[4btabdeberes] ‚úÖ Sub-tab activado:', subTabName);
  } else {
    console.error('[4btabdeberes] ‚ùå No se encontr√≥ elemento: subtab-' + subTabName);
  }

  const selectedBtn = document.getElementById('btn-subtab-' + subTabName);
  if (selectedBtn) {
    selectedBtn.classList.add('active');
  } else {
    console.error('[4btabdeberes] ‚ùå No se encontr√≥ bot√≥n: btn-subtab-' + subTabName);
  }

  console.log('Sub-tab Deberes cambiado a:', subTabName);

  if (!deberesSubtabsLoaded[subTabName]) {
    deberesSubtabsLoaded[subTabName] = true;

    if (subTabName === 'lecturas' && window.LecturasModule) {
      console.log('[4btabdeberes] üìñ Inicializando LecturasModule...');
      window.LecturasModule.inicializar();
    } else if (subTabName === 'tareas' && window.TareasModule) {
      console.log('[4btabdeberes] ‚úèÔ∏è Inicializando TareasModule...');
      window.TareasModule.init();
    } else if (subTabName === 'eval' && window.EvalModule) {
      console.log('[4btabdeberes] üìù Inicializando EvalModule...');
      window.EvalModule.init();
    } else if (subTabName === 'todos' && window.TodosModule) {
      console.log('[4btabdeberes] üìã Inicializando TodosModule...');
      window.TodosModule.inicializar();
    } else {
      console.warn('[4btabdeberes] ‚ö†Ô∏è M√≥dulo no encontrado para:', subTabName);
    }
  } else {
    console.log('[4btabdeberes] ‚ÑπÔ∏è M√≥dulo ya inicializado:', subTabName);
  }
}
// MOD-004-S02: FIN

// MOD-004-S03: FUNCI√ìN UPDATE DEBERES BADGE [INICIO]
// Actualizar Badge de Contador
function updateDeberesBadge(tipo, count) {
  const badge = document.querySelector('.tab-badge[data-tab="' + tipo + '"]');
  if (!badge) return;

  if (count > 0) {
    badge.textContent = count;
    badge.style.display = 'inline-block';
  } else {
    badge.style.display = 'none';
  }
}
// MOD-004-S03: FIN

// MOD-004-S04: FUNCI√ìN FILTRAR POR FECHA [INICIO]
// Filtrar Deberes por Rango de Fechas
function filtrarPorFecha(deberes, desde, hasta) {
  if (!Array.isArray(deberes)) return [];
  if (!desde || !hasta) return deberes;

  const fechaDesde = parseFechaDD_MM_AAAA(desde);
  const fechaHasta = parseFechaDD_MM_AAAA(hasta);

  if (!fechaDesde || !fechaHasta) return deberes;

  return deberes.filter(function(deber) {
    if (!deber.fecha) return false;
    const fechaDeber = parseFechaDD_MM_AAAA(deber.fecha);
    if (!fechaDeber) return false;
    return fechaDeber >= fechaDesde && fechaDeber <= fechaHasta;
  });
}
// MOD-004-S04: FIN

// MOD-004-S05: HELPER PARSE FECHA DDMMAAAA [INICIO]
// Parsear Fecha DD/MM/AAAA a Date
function parseFechaDD_MM_AAAA(fecha) {
  if (!fecha) return null;

  try {
    const partes = fecha.split('/');
    if (partes.length !== 3) return null;
    
    const dia = parseInt(partes[0]);
    const mes = parseInt(partes[1]) - 1;
    const anio = parseInt(partes[2]);
    
    return new Date(anio, mes, dia);
  } catch(error) {
    return null;
  }
}
// MOD-004-S05: FIN

// MOD-004-S06: FUNCI√ìN ORDENAR POR FECHA [INICIO]
// Ordenar por Fecha
function ordenarPorFecha(deberes) {
  return deberes.sort(function(a, b) {
    if (!a.fecha) return 1;
    if (!b.fecha) return -1;

    const fechaA = parseFechaDD_MM_AAAA(a.fecha);
    const fechaB = parseFechaDD_MM_AAAA(b.fecha);

    if (!fechaA) return 1;
    if (!fechaB) return -1;

    return fechaA - fechaB;
  });
}
// MOD-004-S06: FIN

// MOD-004-S07: AUTO-ACTIVACI√ìN Y LOGS FINALES [INICIO]
// Auto-activar Sub-tab por defecto
setTimeout(function() {
  console.log('[4btabdeberes] üöÄ Auto-activando sub-tab por defecto: todos');
  switchSubTabDeberes('todos');
}, 100);

console.log('%cüìù Tab Deberes Cargado [V01.20]', 
            'font-size: 12px; font-weight: bold; color: #667eea;');
console.log('Sub-tabs disponibles: Todos, Evaluaciones, Tareas, Lecturas');
console.log('Funciones auxiliares: updateDeberesBadge, filtrarPorFecha, ordenarPorFecha');
console.log('currentUser disponible:', typeof currentUser !== 'undefined');
console.log('Lazy-init habilitado para todos los sub-tabs');
// MOD-004-S07: FIN

</script>
<!-- MOD-004: FIN -->

<!-- MOD-099: NOTAS [INICIO] -->
<!--
DESCRIPCI√ìN:
Contenedor de sub-tabs de Deberes con sistema lazy-load.
Incluye: Todos, Evaluaciones, Tareas y Lecturas.

ESTRUCTURA:
MOD-001: Encabezado
MOD-002: Estilos
MOD-003: Contenedor subtabs
MOD-004: JavaScript con 7 subm√≥dulos
MOD-004-S01: Variables globales lazy-init
MOD-004-S02: Funci√≥n switchSubTabDeberes
MOD-004-S03: Funci√≥n updateDeberesBadge
MOD-004-S04: Funci√≥n filtrarPorFecha
MOD-004-S05: Helper parseFechaDD_MM_AAAA
MOD-004-S06: Funci√≥n ordenarPorFecha
MOD-004-S07: Auto-activaci√≥n y logs
MOD-099: Notas

CAMBIOS V01.29 ‚Üí V01.30:
- Submodulaci√≥n de MOD-004 (7 subm√≥dulos)
- FIX: Correcci√≥n llamada a LecturasModule.inicializar() en MOD-004-S02
- Aplicaci√≥n est√°ndar CodeWorkShop v5.0
-->
<!-- MOD-099: FIN -->
