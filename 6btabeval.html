<!-- MOD-001: ENCABEZADO [INICIO] -->
<!--
*****************************************
PROYECTO: PBE Control
ARCHIVO: 6btabeval.html
VERSI√ìN: 01.30
FECHA: 27/01/2026 07:11 (UTC-5)
*****************************************
-->
<!-- MOD-001: FIN -->

<!-- MOD-002: ESTILOS [INICIO] -->
<style>
/* MOD-002-S01: CONTENEDOR PRINCIPAL [INICIO] */
.eval-container {
  background: white;
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}
/* MOD-002-S01: FIN */

/* MOD-002-S02: HEADER PRINCIPAL [INICIO] */
.eval-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
  flex-wrap: wrap;
  gap: 16px;
}

.eval-header h2 {
  color: #333;
  font-size: 20px;
  margin: 0;
}

.header-actions {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}
/* MOD-002-S02: FIN */

/* MOD-002-S03: FILTROS LABEL [INICIO] */
.filtro-container {
  display: flex;
  align-items: center;
  gap: 8px;
}

.filtro-container label {
  font-size: 13px;
  font-weight: 600;
  color: #666;
}
/* MOD-002-S03: FIN */

/* MOD-002-S04: FILTRO SELECT [INICIO] */
.filtro-container select {
  padding: 8px 12px;
  border: 2px solid #ddd;
  border-radius: 6px;
  font-size: 13px;
  min-width: 150px;
  cursor: pointer;
  transition: border-color 0.3s;
}

.filtro-container select:focus {
  outline: none;
  border-color: #667eea;
}
/* MOD-002-S04: FIN */

/* MOD-002-S05: BOT√ìN AGREGAR [INICIO] */
.btn-agregar {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3);
}

.btn-agregar:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}
/* MOD-002-S05: FIN */

/* MOD-002-S06: BOTONES BASE [INICIO] */
.btn {
  padding: 10px 20px;
  border: none;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  font-family: inherit;
}
/* MOD-002-S06: FIN */

/* MOD-002-S07: BOTONES PRIMARIOS [INICIO] */
.btn-primary {
  background: #667eea;
  color: white;
}

.btn-primary:hover {
  background: #5568d3;
}
/* MOD-002-S07: FIN */

/* MOD-002-S08: BOTONES SECUNDARIOS [INICIO] */
.btn-secondary {
  background: #6c757d;
  color: white;
}

.btn-secondary:hover {
  background: #5a6268;
}
/* MOD-002-S08: FIN */

/* MOD-002-S09: BOTONES ICONO [INICIO] */
.btn-icon {
  background: transparent;
  border: none;
  color: #667eea;
  cursor: pointer;
  font-size: 18px;
  padding: 4px 8px;
  transition: all 0.2s;
}

.btn-icon:hover {
  transform: scale(1.2);
}

.btn-icon.delete {
  color: #dc3545;
}
/* MOD-002-S09: FIN */

/* MOD-002-S10: FORMULARIO BASE [INICIO] */
.form-eval {
  background: #f9f9f9;
  border: 2px solid #e0e0e0;
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 24px;
  display: none;
}

.form-eval.active {
  display: block;
  animation: slideDown 0.3s ease-out;
}
/* MOD-002-S10: FIN */

/* MOD-002-S11: FORM ANIMACI√ìN [INICIO] */
@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
/* MOD-002-S11: FIN */

/* MOD-002-S12: FORM LAYOUT [INICIO] */
.form-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 16px;
  margin-bottom: 16px;
}

.form-group {
  margin-bottom: 0;
}
/* MOD-002-S12: FIN */

/* MOD-002-S13: FORM LABELS [INICIO] */
.form-group label {
  display: block;
  font-size: 13px;
  font-weight: 600;
  color: #333;
  margin-bottom: 6px;
}
/* MOD-002-S13: FIN */

/* MOD-002-S14: FORM REQUIRED [INICIO] */
.form-group label .required {
  color: #dc3545;
}
/* MOD-002-S14: FIN */

/* MOD-002-S15: FORM INPUTS [INICIO] */
.form-group input,
.form-group select {
  width: 100%;
  padding: 10px 12px;
  font-size: 14px;
  border: 2px solid #ddd;
  border-radius: 6px;
  transition: all 0.3s;
  font-family: inherit;
}
/* MOD-002-S15: FIN */

/* MOD-002-S16: FORM FOCUS [INICIO] */
.form-group input:focus,
.form-group select:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}
/* MOD-002-S16: FIN */

/* MOD-002-S17: FORM SMALL TEXT [INICIO] */
.form-group small {
  display: block;
  margin-top: 4px;
  font-size: 12px;
  color: #666;
}
/* MOD-002-S17: FIN */

/* MOD-002-S18: FORM ACTIONS [INICIO] */
.form-actions {
  display: flex;
  gap: 12px;
  margin-top: 16px;
}
/* MOD-002-S18: FIN */

/* MOD-002-S19: TABLA CONTAINER [INICIO] */
.eval-table-container {
  overflow-x: auto;
}

.eval-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}
/* MOD-002-S19: FIN */

/* MOD-002-S20: TABLA HEADER [INICIO] */
.eval-table thead {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.eval-table th {
  padding: 12px;
  text-align: left;
  font-weight: 600;
  font-size: 13px;
}
/* MOD-002-S20: FIN */

/* MOD-002-S21: TABLA BODY [INICIO] */
.eval-table tbody tr {
  border-bottom: 1px solid #e0e0e0;
  transition: background 0.2s;
}

.eval-table tbody tr:hover {
  background: #f8f9fa;
}

.eval-table td {
  padding: 12px;
  color: #333;
}
/* MOD-002-S21: FIN */

/* MOD-002-S22: CURSO TAG [INICIO] */
.curso-tag {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 600;
  background: #e9ecef;
  color: #495057;
}
/* MOD-002-S22: FIN */

/* MOD-002-S23: NOTA CELLS [INICIO] */
.nota-cell {
  text-align: center;
  font-weight: 600;
  font-size: 15px;
}

.nota-alta {
  color: #28a745;
}

.nota-media {
  color: #ffc107;
}

.nota-baja {
  color: #dc3545;
}

.nota-pendiente {
  color: #999;
  font-style: italic;
}

.peso-cell {
  text-align: center;
  color: #666;
}

.sem-cell {
  text-align: center;
  color: #666;
  font-size: 13px;
}
/* MOD-002-S23: FIN */

/* MOD-002-S24: ESTADOS + RESPONSIVE [INICIO] */
.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: #999;
}

.empty-state-icon {
  font-size: 48px;
  margin-bottom: 12px;
  opacity: 0.5;
}

.empty-state-text {
  font-size: 15px;
}

.loading-container {
  text-align: center;
  padding: 40px;
  color: #667eea;
}

.spinner {
  display: inline-block;
  width: 40px;
  height: 40px;
  border: 4px solid rgba(102, 126, 234, 0.2);
  border-top-color: #667eea;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

@media (max-width: 768px) {
  .eval-container {
    padding: 16px;
  }

  .eval-header {
    flex-direction: column;
    align-items: flex-start;
  }

  .header-actions {
    width: 100%;
  }

  .btn-agregar,
  .filtro-container {
    width: 100%;
  }

  .filtro-container {
    flex-direction: column;
    align-items: flex-start;
  }

  .filtro-container select {
    width: 100%;
  }

  .form-row {
    grid-template-columns: 1fr;
  }

  .form-actions {
    flex-direction: column;
  }

  .form-actions .btn {
    width: 100%;
  }

  .eval-table {
    font-size: 13px;
  }

  .eval-table th,
  .eval-table td {
    padding: 8px;
  }

  .eval-table .col-sem {
    display: none;
  }
}
/* MOD-002-S24: FIN */
</style>
<!-- MOD-002: FIN -->

<!-- MOD-003: CONTENEDOR PRINCIPAL [INICIO] -->
<div class="eval-container">

<!-- MOD-003-S01: HEADER Y FILTROS V2 [INICIO] -->
  <div class="eval-header">
    <h2>üìù Mis Evaluaciones</h2>
    <div class="header-actions">
      <div class="filtro-container">
        <label for="filtroCursoEval">Filtrar:</label>
        <select id="filtroCursoEval" onchange="EvalModule.aplicarFiltro()">
          <option value="">Todos los cursos</option>
        </select>
      </div>
      <button class="btn-agregar" onclick="EvalModule.toggleFormAgregar()">
        + Agregar Evaluaci√≥n
      </button>
    </div>
  </div>
  <!-- MOD-003-S01: FIN -->

<!-- MOD-003-S02: FORMULARIO AGREGAR/EDITAR V2 [INICIO] -->
  <div id="formEval" class="form-eval">
    <h3 id="formTitle" style="margin-bottom: 16px; color: #667eea;">Agregar Nueva Evaluaci√≥n</h3>

    <form id="evalForm" onsubmit="EvalModule.handleSubmitEval(event)">
      <input type="hidden" id="evalRowNumber" value="">
      <input type="hidden" id="evalModoEdicion" value="false">

      <!-- MOD-003-S02-A: FILA 1 - CURSO, NOMBRE, FECHA -->
      <div class="form-row">
        <div class="form-group">
          <label>Curso <span class="required">*</span></label>
          <select id="evalCurso" required>
            <option value="">Seleccionar curso...</option>
          </select>
        </div>

        <div class="form-group">
          <label>Nombre de la Evaluaci√≥n <span class="required">*</span></label>
          <input
            type="text"
            id="evalNomEval"
            placeholder="Ej: Parcial 1, Examen Final"
            required
          >
          <small>Nombre √∫nico por curso</small>
        </div>

        <div class="form-group">
          <label>Fecha de Evaluaci√≥n <span class="required">*</span></label>
          <input
            type="text"
            id="evalFechaEval"
            placeholder="DD/MM/AAAA"
            required
          >
        </div>
      </div>

      <!-- MOD-003-S02-B: FILA 2 - NOTA, PESO, SEMANA -->
      <div class="form-row">
        <div class="form-group">
          <label>Nota (Opcional)</label>
          <input
            type="number"
            id="evalNota"
            placeholder="0 - 20"
            min="0"
            max="20"
            step="0.1"
          >
          <small>Calificaci√≥n obtenida (0-20)</small>
        </div>

        <div class="form-group">
          <label>Peso (Opcional)</label>
          <input
            type="number"
            id="evalPeso"
            placeholder="%"
            min="0"
            max="100"
            step="1"
          >
          <small>Peso en porcentaje (ej: 30)</small>
        </div>

        <div class="form-group">
          <label>Semana (Opcional)</label>
          <input
            type="number"
            id="evalSem"
            placeholder="N√∫mero de semana"
            min="1"
            step="1"
          >
          <small>N√∫mero de semana acad√©mica</small>
        </div>
      </div>

      <!-- MOD-003-S02-C: BOTONES ACCI√ìN -->
      <div class="form-actions">
        <button type="submit" class="btn btn-primary" id="btnSubmit">
          Guardar Evaluaci√≥n
        </button>
        <button type="button" class="btn btn-secondary" onclick="EvalModule.cancelarFormEval()">
          Cancelar
        </button>
      </div>
    </form>
  </div>
  <!-- MOD-003-S02: FIN -->

<!-- MOD-003-S03: CONTENEDOR TABLA [INICIO] -->
  <div id="evalTableContainer" class="eval-table-container">
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Cargando evaluaciones...</p>
    </div>
  </div>
  <!-- MOD-003-S03: FIN -->

</div>
<!-- MOD-003: FIN -->

<!-- MOD-004: JAVASCRIPT V3 [INICIO] -->
<script>

// MOD-004-S01: ENCAPSULAMIENTO IIFE Y VARIABLES [INICIO]
(function PBE_EVAL_MODULE() {
  // QUITAMOS 'use strict' TEMPORALMENTE

  let evaluacionesData = [];
  let cursosData = [];
  let evaluacionesFiltradas = [];
  let _initDone = false;
// MOD-004-S01: FIN

// MOD-004-S02: INICIALIZACI√ìN V5 [INICIO]
  function init() {
    if (_initDone) return;

    if (typeof currentUser === 'undefined' || !currentUser.codeAlum) {
      showAlert('error', 'Error: No se pudo identificar al usuario');
      return;
    }

    _initDone = true;
    cargarCursos();
    cargarEvaluaciones();
    
    setTimeout(function() {
      const btnAgregar = document.querySelector('.eval-container .btn-agregar');
      if (btnAgregar) {
        btnAgregar.addEventListener('click', function() {
          console.log('üî¥ BOT√ìN +AGREGAR EVALUACI√ìN PRESIONADO (evento directo)');
        });
        console.log('‚úÖ Listener de EVALUACIONES agregado a:', btnAgregar);
      } else {
        console.log('‚ùå Bot√≥n .eval-container .btn-agregar NO encontrado');
      }
    }, 500);
  }

  window.addEventListener('load', init);

  if (typeof currentUser !== 'undefined' && currentUser && currentUser.codeAlum) {
    init();
  }
// MOD-004-S02: FIN

// MOD-004-S03: CARGA DE CURSOS V2 [INICIO]
  function cargarCursos() {
    google.script.run
      .withSuccessHandler(handleCursosLoaded)
      .withFailureHandler(handleError)
      .studentObtenerCursos({ codeAlum: currentUser.codeAlum });
  }

  function handleCursosLoaded(response) {
    if (!response || response.success !== true) {
      const msg = response && response.error ? response.error : 'No se pudieron cargar los cursos.';
      showAlert('error', msg);
      return;
    }

    cursosData = response.data || [];
    poblarDropdownCursos();
  }

  function poblarDropdownCursos() {
    const selectCurso = document.getElementById('evalCurso');
    const selectFiltro = document.getElementById('filtroCursoEval');
    
    if (!selectCurso || !selectFiltro) return;

    const primerOption = selectCurso.options[0] ? selectCurso.options[0].outerHTML : '<option value="">Seleccionar curso...</option>';
    const primerOptionFiltro = selectFiltro.options[0] ? selectFiltro.options[0].outerHTML : '<option value="">Todos los cursos</option>';

    selectCurso.innerHTML = primerOption;
    selectFiltro.innerHTML = primerOptionFiltro;

    cursosData.forEach(function(curso) {
      const opt1 = document.createElement('option');
      opt1.value = curso.Curso;
      opt1.textContent = curso.Curso + ' - ' + curso.Completo;
      selectCurso.appendChild(opt1);

      const opt2 = document.createElement('option');
      opt2.value = curso.Curso;
      opt2.textContent = curso.Curso;
      selectFiltro.appendChild(opt2);
    });
  }
// MOD-004-S03: FIN

// MOD-004-S04: CARGA DE EVALUACIONES [INICIO]
  function cargarEvaluaciones() {
    google.script.run
      .withSuccessHandler(handleEvaluacionesLoaded)
      .withFailureHandler(handleEvalError)
      .studentObtenerEvaluaciones({ codeAlum: currentUser.codeAlum });
  }

  function handleEvaluacionesLoaded(response) {
    if (!response || response.success !== true) {
      const msg = response && response.error ? response.error : 'No se pudieron cargar las evaluaciones.';
      showAlert('error', msg);
      return;
    }

    evaluacionesData = response.data || [];
    aplicarFiltro();
  }

  function handleEvalError(error) {
    console.error('Error:', error);
    showAlert('error', 'Error de conexi√≥n');
  }
// MOD-004-S04: FIN

// MOD-004-S05: FILTRADO Y RENDERIZADO V2 [INICIO]
  function aplicarFiltro() {
    const selectFiltro = document.getElementById('filtroCursoEval');
    const cursoSeleccionado = selectFiltro ? selectFiltro.value : '';

    if (cursoSeleccionado) {
      evaluacionesFiltradas = evaluacionesData.filter(function(ev) {
        return ev.Curso === cursoSeleccionado;
      });
    } else {
      evaluacionesFiltradas = evaluacionesData.slice();
    }

    if (evaluacionesFiltradas.length === 0) {
      renderEmptyState();
    } else {
      renderTable();
    }
  }

  function renderTable() {
    const container = document.getElementById('evalTableContainer');
    if (!container) return;

    let html = '<table class="eval-table"><thead><tr>';
    html += '<th>Curso</th>';
    html += '<th>Evaluaci√≥n</th>';
    html += '<th>Fecha</th>';
    html += '<th>Nota</th>';
    html += '<th>Peso</th>';
    html += '<th class="col-sem">Semana</th>';
    html += '<th>Acciones</th>';
    html += '</tr></thead><tbody>';

    evaluacionesFiltradas.forEach(function(ev) {
      const nomEvalSafe = String(ev.NomEval || '').replace(/'/g, "\\'");
      
      html += '<tr>';
      html += '<td class="curso-cell"><strong>' + ev.Curso + '</strong></td>';
      html += '<td class="eval-cell">' + ev.NomEval + '</td>';
      html += '<td class="fecha-cell">' + (ev.FechaEval || '-') + '</td>';
      html += '<td class="nota-cell">';
      html += ev.Nota ? '<span class="' + obtenerClaseNota(ev.Nota) + '">' + ev.Nota + '</span>' : '<span class="nota-pendiente">Pendiente</span>';
      html += '</td>';
      html += '<td class="peso-cell">' + (ev.Peso ? ev.Peso + '%' : '-') + '</td>';
      html += '<td class="sem-cell col-sem">' + (ev.Sem || '-') + '</td>';
      html += '<td>';
      html += '<button class="btn-icon" onclick="EvalModule.editarEval(' + ev._rowNumber + ')" title="Editar">‚úèÔ∏è</button>';
      html += '<button class="btn-icon delete" onclick="EvalModule.confirmarEliminarEval(' + ev._rowNumber + ', \'' + nomEvalSafe + '\')" title="Eliminar">üóëÔ∏è</button>';
      html += '</td>';
      html += '</tr>';
    });

    html += '</tbody></table>';
    container.innerHTML = html;
  }

  function renderEmptyState() {
    const container = document.getElementById('evalTableContainer');
    const selectFiltro = document.getElementById('filtroCursoEval');
    const filtroActivo = selectFiltro ? (selectFiltro.value !== '') : false;

    if (filtroActivo) {
      container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üîç</div><div class="empty-state-text">No hay evaluaciones para el curso seleccionado.</div></div>';
    } else {
      container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìù</div><div class="empty-state-text">No tienes evaluaciones registradas a√∫n.<br>Haz clic en "+ Agregar Evaluaci√≥n" para comenzar.</div></div>';
    }
  }
// MOD-004-S05: FIN

// MOD-004-S06: FORMULARIO TOGGLE Y SUBMIT V2 [INICIO]
  function toggleFormAgregar() {
    const form = document.getElementById('formEval');
    const isActive = form.classList.contains('active');

    if (isActive) {
      form.classList.remove('active');
    } else {
      resetFormEval();
      document.getElementById('formTitle').textContent = 'Agregar Nueva Evaluaci√≥n';
      document.getElementById('evalModoEdicion').value = 'false';
      form.classList.add('active');
    }
  }

  function validarFecha(fecha) {
    const regex = /^\d{2}\/\d{2}\/\d{4}$/;
    return regex.test(fecha);
  }

  function handleSubmitEval(event) {
    event.preventDefault();

    const curso = document.getElementById('evalCurso').value;
    const nomEval = document.getElementById('evalNomEval').value.trim();
    const fechaEval = document.getElementById('evalFechaEval').value.trim();
    const nota = document.getElementById('evalNota').value.trim();
    const peso = document.getElementById('evalPeso').value.trim();
    const sem = document.getElementById('evalSem').value.trim();
    const rowNumber = document.getElementById('evalRowNumber').value;
    const esEdicion = document.getElementById('evalModoEdicion').value === 'true';

    if (!curso || !nomEval || !fechaEval) {
      showAlert('error', 'Completa todos los campos obligatorios');
      return;
    }

    if (!validarFecha(fechaEval)) {
      showAlert('error', 'Formato de fecha inv√°lido. Usa DD/MM/AAAA');
      return;
    }

    const params = {
      codeAlum: currentUser.codeAlum,
      curso: curso,
      nomEval: nomEval,
      fechaEval: fechaEval,
      nota: nota,
      peso: peso,
      sem: sem
    };

    if (esEdicion) {
      params.rowNumber = rowNumber;
      google.script.run
        .withSuccessHandler(handleEvalSaved)
        .withFailureHandler(handleEvalError)
        .studentActualizarEvaluacion(params);
    } else {
      google.script.run
        .withSuccessHandler(handleEvalSaved)
        .withFailureHandler(handleEvalError)
        .studentAgregarEvaluacion(params);
    }
  }

  function handleEvalSaved(response) {
    if (!response || response.success !== true) {
      const msg = response && response.error ? response.error : 'No se pudo guardar la evaluaci√≥n.';
      showAlert('error', msg);
      return;
    }

    showAlert('success', '‚úì Evaluaci√≥n guardada exitosamente');
    document.getElementById('formEval').classList.remove('active');
    resetFormEval();
    cargarEvaluaciones();
  }

  function resetFormEval() {
    document.getElementById('evalForm').reset();
    document.getElementById('evalRowNumber').value = '';
    document.getElementById('evalModoEdicion').value = 'false';
  }

  function cancelarFormEval() {
    document.getElementById('formEval').classList.remove('active');
    resetFormEval();
  }
// MOD-004-S06: FIN

// MOD-004-S07: EDICI√ìN Y ELIMINACI√ìN [INICIO]
  function editarEval(rowNumber) {
    const evaluacion = evaluacionesData.find(function(e) {
      return e._rowNumber === rowNumber;
    });

    if (!evaluacion) {
      showAlert('error', 'No se encontr√≥ la evaluaci√≥n');
      return;
    }

    document.getElementById('formTitle').textContent = 'Editar Evaluaci√≥n';
    document.getElementById('evalCurso').value = evaluacion.Curso || '';
    document.getElementById('evalNomEval').value = evaluacion.NomEval || '';
    document.getElementById('evalFechaEval').value = evaluacion.FechaEval || '';
    document.getElementById('evalNota').value = evaluacion.Nota || '';
    document.getElementById('evalPeso').value = evaluacion.Peso || '';
    document.getElementById('evalSem').value = evaluacion.Sem || '';
    document.getElementById('evalRowNumber').value = rowNumber;
    document.getElementById('evalModoEdicion').value = 'true';
    
    document.getElementById('formEval').classList.add('active');
  }

  function confirmarEliminarEval(rowNumber, nombre) {
    if (confirm('¬øEliminar la evaluaci√≥n "' + nombre + '"?')) {
      eliminarEval(rowNumber);
    }
  }

  function eliminarEval(rowNumber) {
    google.script.run
      .withSuccessHandler(handleEvalDeleted)
      .withFailureHandler(handleEvalError)
      .studentEliminarEvaluacion({ rowNumber: rowNumber });
  }

  function handleEvalDeleted(response) {
    if (!response || response.success !== true) {
      const msg = response && response.error ? response.error : 'No se pudo eliminar la evaluaci√≥n.';
      showAlert('error', msg);
      return;
    }

    showAlert('success', '‚úì Evaluaci√≥n eliminada exitosamente');
    cargarEvaluaciones();
  }
// MOD-004-S07: FIN

// MOD-004-S08: HELPERS Y EXPORTACI√ìN V3 [INICIO]
  function obtenerClaseNota(nota) {
    if (!nota) return 'nota-pendiente';

    const notaNum = parseFloat(nota);

    if (notaNum >= 14) return 'nota-alta';
    if (notaNum >= 11) return 'nota-media';
    return 'nota-baja';
  }

  function handleError(error) {
    console.error('Error:', error);
    showAlert('error', 'Error de conexi√≥n');
  }

  window.EvalModule = {
    init: init,
    aplicarFiltro: aplicarFiltro,
    toggleFormAgregar: toggleFormAgregar,
    handleSubmitEval: handleSubmitEval,
    editarEval: editarEval,
    confirmarEliminarEval: confirmarEliminarEval,
    cancelarFormEval: cancelarFormEval
  };

  console.log('%cüìù Sub-tab Evaluaciones V01.30 cargado', 'font-size: 11px; color: #667eea;');
// MOD-004-S08: FIN

})();

</script>
<!-- MOD-004: FIN -->

<!-- MOD-099: NOTAS [INICIO] -->
<!--
6btabeval.html V01.30 - Sub-tab Evaluaciones CRUD

ESTRUCTURA: MOD-002 CSS (24 subm√≥dulos) | MOD-003 HTML (3 subm√≥dulos) | MOD-004 JS (8 subm√≥dulos)

FUNCIONALIDAD: CRUD completo, filtrado por curso, validaci√≥n fechas DD/MM/AAAA

BACKEND: studentObtenerCursos/Evaluaciones, studentAgregar/Actualizar/EliminarEvaluacion

COLORES NOTA: Verde ‚â•14 | Amarillo 11-13 | Rojo <11

PATR√ìN EXPORTS: Todas las funciones encapsuladas en window.EvalModule (evita colisi√≥n global)

V01.29‚ÜíV01.30: FIX cr√≠tico colisi√≥n funciones globales
- HTML onclick/onchange ‚Üí EvalModule.X() (4 lugares en MOD-003)
- JS getElementById('filtroCurso') ‚Üí getElementById('filtroCursoEval')
- Eliminados exports globales directos (window.aplicarFiltro, etc.)
- Expandido window.EvalModule con todas las funciones p√∫blicas
-->
<!-- MOD-099: FIN -->
