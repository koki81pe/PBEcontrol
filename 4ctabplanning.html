<!-- MOD-001: ENCABEZADO [INICIO] -->
<!--
*****************************************
PROYECTO: PBE Control
ARCHIVO: 4ctabplanning.html
VERSIÃ“N: 01.19
FECHA: 18/01/2026 15:07 (UTC-5)
*****************************************
-->
<!-- MOD-001: FIN -->

<!-- MOD-002: ESTILOS [INICIO] -->
<style>
.subtabs-container { margin-bottom: 20px; }
.subtabs-nav {
  display: flex;
  gap: 8px;
  border-bottom: 2px solid #e0e0e0;
  margin-bottom: 20px;
}
.subtab-btn {
  padding: 12px 24px;
  font-size: 14px;
  font-weight: 600;
  color: #666;
  background: transparent;
  border: none;
  border-bottom: 3px solid transparent;
  cursor: pointer;
  transition: all 0.3s;
  white-space: nowrap;
}
.subtab-btn:hover { color: #667eea; background: #f9f9f9; }
.subtab-btn.active { color: #667eea; border-bottom-color: #667eea; }
.subtab-content { display: none; }
.subtab-content.active { display: block; animation: fadeIn 0.3s ease-out; }

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

@media (max-width: 768px) {
  .subtabs-nav { overflow-x: auto; }
  .subtab-btn { padding: 10px 18px; font-size: 13px; }
}
</style>
<!-- MOD-002: FIN -->

<!-- MOD-003: CONTENEDOR SUBTABS [INICIO] -->
<div class="subtabs-container" id="planning-container">

  <div class="subtabs-nav">
    <button class="subtab-btn active" onclick="PlanningModule.switchTab('horarioclase')">ğŸ• Horario Clases</button>
    <button class="subtab-btn" onclick="PlanningModule.switchTab('horariosem')">ğŸ“… Horario Semanal</button>
    <button class="subtab-btn" onclick="PlanningModule.switchTab('notas')">ğŸ“Š Notas</button>
    <button class="subtab-btn" onclick="PlanningModule.switchTab('calendario')">ğŸ—“ï¸ Calendario</button>
  </div>

  <div id="subtab-horarioclase" class="subtab-content active">
    <?!= include('7ctabhorarioclase'); ?>
  </div>

  <div id="subtab-horariosem" class="subtab-content">
    <?!= include('7ctabhorariosem'); ?>
  </div>

  <div id="subtab-notas" class="subtab-content">
    <?!= include('7ctabnotas'); ?>
  </div>

  <div id="subtab-calendario" class="subtab-content">
    <?!= include('7ctabcalendario'); ?>
  </div>

</div>
<!-- MOD-003: FIN -->

<!-- MOD-004: JAVASCRIPT [INICIO] -->
<script>
// Planning Module (Encapsulado)
window.PlanningModule = (function () {

  const state = {
    currentWeekOffset: 0,
    currentMonth: new Date().getMonth(),
    currentYear: new Date().getFullYear()
  };

  function getContainer() {
    return document.getElementById('planning-container');
  }

  function switchTab(name) {
    const container = getContainer();
    if (!container) return;

    container.querySelectorAll('.subtab-content').forEach(el => el.classList.remove('active'));
    container.querySelectorAll('.subtab-btn').forEach(el => el.classList.remove('active'));

    const tab = document.getElementById('subtab-' + name);
    if (tab) tab.classList.add('active');

    const btn = [...container.querySelectorAll('.subtab-btn')]
      .find(b => b.textContent.toLowerCase().includes(name.replace('horario', 'horario')));
    if (btn) btn.classList.add('active');

    console.log('[Planning] Sub-tab activo:', name);
  }

  // Helpers reutilizados por sub-tabs
  function obtenerDiasSemanaActual() {
    const hoy = new Date();
    const lunes = new Date(hoy);
    lunes.setDate(hoy.getDate() - ((hoy.getDay() + 6) % 7));
    return Array.from({ length: 7 }, (_, i) => new Date(lunes.getFullYear(), lunes.getMonth(), lunes.getDate() + i));
  }

  function horaAMinutos(h) {
    if (!h || !h.includes(':')) return 0;
    const [hh, mm] = h.split(':').map(Number);
    return (hh * 60) + mm;
  }

  function minutosAHora(m) {
    const h = Math.floor(m / 60);
    const mm = m % 60;
    return String(h).padStart(2, '0') + ':' + String(mm).padStart(2, '0');
  }

  function calcularPromedioPonderado(items = []) {
    let total = 0, peso = 0;
    items.forEach(i => {
      const n = parseFloat(i.nota), p = parseFloat(i.peso);
      if (!isNaN(n) && !isNaN(p)) {
        total += n * p;
        peso += p;
      }
    });
    return peso ? (total / peso).toFixed(2) : 0;
  }

  console.log('%cğŸ“… Planning V01.19 cargado', 'color:#667eea;font-weight:bold;');

  return {
    switchTab,
    state,
    obtenerDiasSemanaActual,
    horaAMinutos,
    minutosAHora,
    calcularPromedioPonderado
  };

})();
</script>
<!-- MOD-004: FIN -->

<!-- MOD-099: NOTAS [INICIO] -->
<!--
DESCRIPCIÃ“N:
Contenedor de sub-tabs de Planning
MÃ³dulo totalmente encapsulado en PlanningModule

SUB-TABS INCLUIDOS:
- subtab-horarioclase â†’ include('7ctabhorarioclase'): Horario de clases
- subtab-horariosem â†’ include('7ctabhorariosem'): Horario semanal
- subtab-notas â†’ include('7ctabnotas'): Sistema de notas y promedios
- subtab-calendario â†’ include('7ctabcalendario'): Vista de calendario

ESTRUCTURA:
Contenedor ligero que organiza cuatro sub-tabs de planning:
1. Horario Clases: GestiÃ³n de horarios de clases
2. Horario Semanal: Vista semanal del horario
3. Notas: CÃ¡lculo de promedios ponderados
4. Calendario: Vista de calendario mensual

MÃ“DULO ENCAPSULADO:
window.PlanningModule: IIFE que expone funciones pÃºblicas
- Previene colisiones globales
- Encapsula estado interno
- Provee helpers compartidos

FUNCIONALIDAD:
- NavegaciÃ³n entre sub-tabs mediante PlanningModule.switchTab()
- Estado compartido: currentWeekOffset, currentMonth, currentYear
- Helpers disponibles para todos los sub-tabs

ESTADO COMPARTIDO:
- state.currentWeekOffset: Offset de semana actual (para navegaciÃ³n)
- state.currentMonth: Mes actual en vista de calendario
- state.currentYear: AÃ±o actual en vista de calendario

HELPERS COMPARTIDOS:
- obtenerDiasSemanaActual(): Retorna array de 7 dÃ­as (L-D) de la semana actual
- horaAMinutos(hora): Convierte "HH:MM" a minutos totales
- minutosAHora(minutos): Convierte minutos totales a "HH:MM"
- calcularPromedioPonderado(items): Calcula promedio con pesos

FLUJO DE NAVEGACIÃ“N:
1. Usuario hace clic en botÃ³n de sub-tab
2. onclick llama a PlanningModule.switchTab(name)
3. switchTab() actualiza clases active en DOM
4. Sub-tab correspondiente se muestra con animaciÃ³n fadeIn

CARACTERÃSTICAS TÃ‰CNICAS:
- IIFE completo para encapsulaciÃ³n total
- Getters seguros (getContainer verifica existencia)
- Helpers matemÃ¡ticos para horarios y notas
- Estado interno protegido
- API pÃºblica clara y limitada

DEPENDENCIAS:
- Sub-mÃ³dulos: 7ctabhorarioclase.html, 7ctabhorariosem.html, 7ctabnotas.html, 7ctabcalendario.html
- currentUser: Variable global del panel principal
- Funciones globales: showAlert, showLoading, hideLoading (del parent)

USO DE HELPERS DESDE SUB-TABS:
// En cualquier sub-tab de planning:
const dias = PlanningModule.obtenerDiasSemanaActual();
const minutos = PlanningModule.horaAMinutos('14:30');
const promedio = PlanningModule.calcularPromedioPonderado(evaluaciones);

VENTAJAS DEL ENCAPSULADO:
- Sin colisiones de nombres en scope global
- Estado centralizado y protegido
- Helpers compartidos sin duplicaciÃ³n
- FÃ¡cil debugging (todo bajo PlanningModule)

CAMBIOS V01.18 â†’ V01.19:
- RemodulaciÃ³n completa segÃºn EstÃ¡ndar CodeWorkShop v4.0
- CSS encapsulado en MOD-002
- HTML en MOD-003
- JavaScript (IIFE) en MOD-004
- Comentarios consolidados en MOD-099
- Estructura consistente con otros contenedores de sub-tabs
-->
<!-- MOD-099: FIN -->
