<!--
******************************************
PBE CONTROL - 4ctabplanning.html - V01.18
Sistema de GestiÃ³n AcadÃ©mica
07/01/2026
DESCRIPCIÃ“N:
Contenedor de sub-tabs de Planning.
VERSIÃ“N:
- Encapsulado total
- PrevenciÃ³n de colisiones globales
- DOM-safe
******************************************
-->

<style>
  .subtabs-container { margin-bottom: 20px; }
  .subtabs-nav {
    display: flex;
    gap: 8px;
    border-bottom: 2px solid #e0e0e0;
    margin-bottom: 20px;
  }
  .subtab-btn {
    padding: 12px 24px;
    font-size: 14px;
    font-weight: 600;
    color: #666;
    background: transparent;
    border: none;
    border-bottom: 3px solid transparent;
    cursor: pointer;
    transition: all 0.3s;
    white-space: nowrap;
  }
  .subtab-btn:hover { color: #667eea; background: #f9f9f9; }
  .subtab-btn.active { color: #667eea; border-bottom-color: #667eea; }
  .subtab-content { display: none; }
  .subtab-content.active { display: block; animation: fadeIn 0.3s ease-out; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @media (max-width: 768px) {
    .subtabs-nav { overflow-x: auto; }
    .subtab-btn { padding: 10px 18px; font-size: 13px; }
  }
</style>

<div class="subtabs-container" id="planning-container">

  <div class="subtabs-nav">
    <button class="subtab-btn active" onclick="PlanningModule.switchTab('horarioclase')">ğŸ• Horario Clases</button>
    <button class="subtab-btn" onclick="PlanningModule.switchTab('horariosem')">ğŸ“… Horario Semanal</button>
    <button class="subtab-btn" onclick="PlanningModule.switchTab('notas')">ğŸ“Š Notas</button>
    <button class="subtab-btn" onclick="PlanningModule.switchTab('calendario')">ğŸ—“ï¸ Calendario</button>
  </div>

  <div id="subtab-horarioclase" class="subtab-content active">
    <?!= include('7ctabhorarioclase'); ?>
  </div>

  <div id="subtab-horariosem" class="subtab-content">
    <?!= include('7ctabhorariosem'); ?>
  </div>

  <div id="subtab-notas" class="subtab-content">
    <?!= include('7ctabnotas'); ?>
  </div>

  <div id="subtab-calendario" class="subtab-content">
    <?!= include('7ctabcalendario'); ?>
  </div>

</div>

<script>
/* ==========================================
   PLANNING MODULE (ENCAPSULADO)
========================================== */
window.PlanningModule = (function () {

  const state = {
    currentWeekOffset: 0,
    currentMonth: new Date().getMonth(),
    currentYear: new Date().getFullYear()
  };

  function getContainer() {
    return document.getElementById('planning-container');
  }

  function switchTab(name) {
    const container = getContainer();
    if (!container) return;

    container.querySelectorAll('.subtab-content').forEach(el => el.classList.remove('active'));
    container.querySelectorAll('.subtab-btn').forEach(el => el.classList.remove('active'));

    const tab = document.getElementById('subtab-' + name);
    if (tab) tab.classList.add('active');

    const btn = [...container.querySelectorAll('.subtab-btn')]
      .find(b => b.textContent.toLowerCase().includes(name.replace('horario', 'horario')));
    if (btn) btn.classList.add('active');

    console.log('[Planning] Sub-tab activo:', name);
  }

  /* ===== Helpers reutilizados por sub-tabs ===== */

  function obtenerDiasSemanaActual() {
    const hoy = new Date();
    const lunes = new Date(hoy);
    lunes.setDate(hoy.getDate() - ((hoy.getDay() + 6) % 7));
    return Array.from({ length: 7 }, (_, i) => new Date(lunes.getFullYear(), lunes.getMonth(), lunes.getDate() + i));
  }

  function horaAMinutos(h) {
    if (!h || !h.includes(':')) return 0;
    const [hh, mm] = h.split(':').map(Number);
    return (hh * 60) + mm;
  }

  function minutosAHora(m) {
    const h = Math.floor(m / 60);
    const mm = m % 60;
    return String(h).padStart(2, '0') + ':' + String(mm).padStart(2, '0');
  }

  function calcularPromedioPonderado(items = []) {
    let total = 0, peso = 0;
    items.forEach(i => {
      const n = parseFloat(i.nota), p = parseFloat(i.peso);
      if (!isNaN(n) && !isNaN(p)) {
        total += n * p;
        peso += p;
      }
    });
    return peso ? (total / peso).toFixed(2) : 0;
  }

  console.log('%cğŸ“… Planning V01.18 cargado', 'color:#667eea;font-weight:bold;');

  return {
    switchTab,
    state,
    obtenerDiasSemanaActual,
    horaAMinutos,
    minutosAHora,
    calcularPromedioPonderado
  };

})();
</script>
