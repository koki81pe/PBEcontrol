<!--
******************************************
PBE CONTROL - 4atabcursosyrep.html - V01.20 GPT
Sistema de GestiÃ³n AcadÃ©mica
05/01/2026

DESCRIPCIÃ“N GENERAL:
Contenedor principal para los sub-tabs de Cursos y Repasos
dentro del Panel del Estudiante.

Este archivo NO contiene lÃ³gica de negocio.
Su Ãºnica funciÃ³n es:
- Organizar visualmente
- Gestionar navegaciÃ³n entre sub-tabs
- Incluir los archivos hijos correspondientes

CAMBIO CRÃTICO V01.20:
- Eliminada inclusiÃ³n directa con <?!= include() ?>
- Carga controlada y Ãºnica de sub-tabs (lazy load)
- Evita re-ejecuciÃ³n de scripts hijos
- Previene redeclaraciÃ³n de variables (ej: cursosData)

MANTIENE:
- EncapsulaciÃ³n con IIFE
- API pÃºblica mÃ­nima (switchSubTab)
******************************************
-->

<!-- ======================================================
     SECCIÃ“N 1: ESTILOS DE LOS SUB-TABS
     Define la apariencia visual de la navegaciÃ³n interna
     ====================================================== -->
<style>

  /* Contenedor general de los sub-tabs */
  .subtabs-container {
    margin-bottom: 20px;
  }

  /* Barra de navegaciÃ³n horizontal */
  .subtabs-nav {
    display: flex;
    gap: 8px;
    border-bottom: 2px solid #e0e0e0;
    margin-bottom: 20px;
  }

  /* Botones de cada sub-tab */
  .subtab-btn {
    padding: 12px 24px;
    font-size: 14px;
    font-weight: 600;
    color: #666;
    background: transparent;
    border: none;
    border-bottom: 3px solid transparent;
    cursor: pointer;
    transition: all 0.3s;
    font-family: inherit;
  }

  /* Hover visual */
  .subtab-btn:hover {
    color: #667eea;
    background: #f9f9f9;
  }

  /* Estado activo */
  .subtab-btn.active {
    color: #667eea;
    border-bottom-color: #667eea;
  }

  /* Contenido de cada sub-tab */
  .subtab-content {
    display: none;
  }

  /* Sub-tab visible */
  .subtab-content.active {
    display: block;
    animation: fadeIn 0.3s ease-out;
  }

  /* AnimaciÃ³n suave al cambiar sub-tab */
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* ===============================
     RESPONSIVE: DISPOSITIVOS MÃ“VILES
     =============================== */
  @media (max-width: 768px) {

    .subtabs-nav {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .subtab-btn {
      white-space: nowrap;
      padding: 10px 20px;
      font-size: 13px;
    }
  }
</style>

<!-- ======================================================
     SECCIÃ“N 2: ESTRUCTURA HTML DE LOS SUB-TABS
     Define botones y contenedores (vacÃ­os)
     ====================================================== -->
<div class="subtabs-container">

  <!-- NavegaciÃ³n entre sub-tabs -->
  <div class="subtabs-nav">

    <!-- BotÃ³n: Cursos -->
    <button class="subtab-btn active"
            id="btn-subtab-cursos"
            onclick="switchSubTab('cursos')">
      ðŸ“š Cursos
    </button>

    <!-- BotÃ³n: Repasos -->
    <button class="subtab-btn"
            id="btn-subtab-repasos"
            onclick="switchSubTab('repasos')">
      ðŸ”„ Repasos
    </button>

  </div>

  <!-- ==================================================
       CONTENEDOR SUB-TAB: CURSOS
       Carga dinÃ¡mica de 5atabcursos.html
       ================================================== -->
  <div id="subtab-cursos" class="subtab-content active">
    <!-- Contenido cargado vÃ­a google.script.run -->
  </div>

  <!-- ==================================================
       CONTENEDOR SUB-TAB: REPASOS
       Carga dinÃ¡mica de 5atabrepasos.html
       ================================================== -->
  <div id="subtab-repasos" class="subtab-content">
    <!-- Contenido cargado vÃ­a google.script.run -->
  </div>

</div>

<!-- ======================================================
     SECCIÃ“N 3: JAVASCRIPT LOCAL (ENCAPSULADO)
     Controla SOLO navegaciÃ³n y carga de sub-tabs
     ====================================================== -->
<script>
(function () {
  'use strict';

  /**
   * ------------------------------------------------------
   * ESTADO INTERNO DE CARGA
   * Evita que un sub-tab se cargue mÃ¡s de una vez
   * ------------------------------------------------------
   */
  const loadedSubTabs = {
    cursos: false,
    repasos: false
  };

  /**
   * ------------------------------------------------------
   * FUNCIÃ“N: loadSubTab
   * Carga el HTML del sub-tab SOLO una vez
   * ------------------------------------------------------
   * @param {string} subTabName - 'cursos' | 'repasos'
   */
  function loadSubTab(subTabName) {

    if (loadedSubTabs[subTabName]) {
      return;
    }

    google.script.run
      .withSuccessHandler(function (html) {
        document.getElementById('subtab-' + subTabName).innerHTML = html;
        loadedSubTabs[subTabName] = true;
        console.log('âœ“ Sub-tab cargado:', subTabName);
      })
      .withFailureHandler(function (error) {
        console.error('Error al cargar sub-tab:', subTabName, error);
      })
      .getHtmlPartial(subTabName);
  }

  /**
   * ------------------------------------------------------
   * FUNCIÃ“N: switchSubTab
   * Cambia visualmente entre Cursos y Repasos
   * ------------------------------------------------------
   * @param {string} subTabName - 'cursos' | 'repasos'
   */
  function switchSubTab(subTabName) {

    // Oculta todos los contenidos
    document.querySelectorAll('.subtab-content')
      .forEach(el => el.classList.remove('active'));

    // Desactiva todos los botones
    document.querySelectorAll('.subtab-btn')
      .forEach(el => el.classList.remove('active'));

    // Activa el contenido seleccionado
    document.getElementById('subtab-' + subTabName)
      .classList.add('active');

    // Activa el botÃ³n correspondiente
    document.getElementById('btn-subtab-' + subTabName)
      .classList.add('active');

    // Carga segura del sub-tab
    loadSubTab(subTabName);

    console.log('Sub-tab cambiado a:', subTabName);
  }

  /**
   * ------------------------------------------------------
   * EXPOSICIÃ“N CONTROLADA DE FUNCIÃ“N
   * Necesaria para onclick del HTML
   * ------------------------------------------------------
   */
  window.switchSubTab = switchSubTab;

  /**
   * ------------------------------------------------------
   * CARGA INICIAL
   * Solo se carga CURSOS al iniciar
   * ------------------------------------------------------
   */
  loadSubTab('cursos');

  /**
   * ------------------------------------------------------
   * LOG DE CONFIRMACIÃ“N
   * ------------------------------------------------------
   */
  console.log(
    '%cðŸ“š Contenedor Cursos/Repasos V01.20 cargado correctamente',
    'font-size:12px;font-weight:bold;color:#667eea'
  );

})();
</script>
