<!--
******************************************
PBE CONTROL - 4atabcursosyrep.html - V01.22 CLAUDE
Sistema de GestiÃ³n AcadÃ©mica
07/01/2026

CAMBIOS V01.22 CLAUDE:
âœ… FIX CRÃTICO: Activa subtab Cursos por defecto
âœ… FIX CRÃTICO: Conecta evento 'pbe:subtab-activated' con mÃ³dulos
âœ… Llama a CursosModule.init() o RepasosModule.init() cuando se activan
âœ… Subtabs ahora se inicializan correctamente

CAMBIOS V01.21 GPT:
- NO se carga ningÃºn subtab automÃ¡ticamente
- Los subtabs solo se inicializan por clic del usuario
- Evita ejecuciÃ³n mÃºltiple de scripts hijos
- Mantiene lazy-load controlado vÃ­a evento
******************************************
-->

<style>
  .subtabs-container { margin-bottom: 20px; }

  .subtabs-nav {
    display: flex;
    gap: 8px;
    border-bottom: 2px solid #e0e0e0;
    margin-bottom: 20px;
  }

  .subtab-btn {
    padding: 12px 24px;
    font-size: 14px;
    font-weight: 600;
    color: #666;
    background: transparent;
    border: none;
    border-bottom: 3px solid transparent;
    cursor: pointer;
    transition: all 0.3s;
  }

  .subtab-btn.active {
    color: #667eea;
    border-bottom-color: #667eea;
  }

  .subtab-content { display: none; }
  .subtab-content.active { display: block; }
</style>

<div class="subtabs-container">

  <div class="subtabs-nav">
    <button class="subtab-btn" id="btn-subtab-cursos"
      onclick="switchSubTab('cursos')">ðŸ“š Cursos</button>

    <button class="subtab-btn" id="btn-subtab-repasos"
      onclick="switchSubTab('repasos')">ðŸ”„ Repasos</button>
  </div>

  <div id="subtab-cursos" class="subtab-content" data-loaded="false">
    <?!= include('5atabcursos'); ?>
  </div>

  <div id="subtab-repasos" class="subtab-content" data-loaded="false">
    <?!= include('5atabrepasos'); ?>
  </div>

</div>

<script>
(function () {
  'use strict';

  const loaded = {
    cursos: false,
    repasos: false
  };

  /* ==========================================
     SWITCH DE SUBTABS
     ========================================== */
  function switchSubTab(name) {

    // Ocultar todos los subtabs
    document.querySelectorAll('.subtab-content')
      .forEach(el => el.classList.remove('active'));

    // Desactivar todos los botones
    document.querySelectorAll('.subtab-btn')
      .forEach(el => el.classList.remove('active'));

    // Activar el subtab seleccionado
    document.getElementById('subtab-' + name).classList.add('active');
    document.getElementById('btn-subtab-' + name).classList.add('active');

    // Inicializar subtab si es primera vez
    if (!loaded[name]) {
      loaded[name] = true;

      // ==========================================
      // V01.22 CLAUDE: LLAMAR DIRECTAMENTE AL MÃ“DULO
      // ==========================================
      console.log('ðŸŸ¢ Inicializando subtab:', name);
      
      if (name === 'cursos' && window.CursosModule) {
        window.CursosModule.init();
      } else if (name === 'repasos' && window.RepasosModule) {
        window.RepasosModule.init();
      }

      // Disparar evento por si algÃºn mÃ³dulo lo necesita
      document.dispatchEvent(
        new CustomEvent('pbe:subtab-activated', {
          detail: name
        })
      );
    }
  }

  /* ==========================================
     V01.22 CLAUDE: AUTO-ACTIVAR CURSOS AL CARGAR
     ========================================== */
  function initDefaultSubTab() {
    console.log('ðŸ“¦ 4atabcursosyrep V01.22 CLAUDE: Activando Cursos por defecto');
    
    // PequeÃ±o delay para asegurar que currentUser estÃ© disponible
    setTimeout(function() {
      switchSubTab('cursos');
    }, 100);
  }

  // Exponer funciÃ³n globalmente
  window.switchSubTab = switchSubTab;

  // Activar subtab por defecto cuando el documento estÃ© listo
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initDefaultSubTab);
  } else {
    initDefaultSubTab();
  }

  console.log('%cðŸ“¦ 4atabcursosyrep V01.22 CLAUDE cargado',
    'font-weight:bold;color:#667eea');
})();
</script>
