<!-- MOD-001: ENCABEZADO [INICIO] -->
<!--
*****************************************
PROYECTO: PBE Control
ARCHIVO: 7ctabhorariosem.html
VERSI√ìN: 01.33
FECHA: 19/01/2026 01:08 (UTC-5)
*****************************************
-->
<!-- MOD-001: FIN -->

<!-- MOD-002: TEXTO LIBRE [INICIO] -->
<!-- Sin conflicto con HorarioClase -->
<!-- MOD-002: FIN -->

<!-- MOD-003: ESTILOS CSS [INICIO] -->
<style>
.hs-container {
  display: grid;
  grid-template-columns: 150px 1fr;
  gap: 20px;
  background: #fff;
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 2px 8px rgba(0,0,0,.08);
  min-height: 600px;
}

.hs-sidebar {
  border-right: 2px solid #e0e0e0;
  padding-right: 16px;
}

.hs-sidebar h3 {
  font-size: 14px;
  color: #667eea;
  margin: 0 0 16px;
  font-weight: 700;
}

.hs-semana-item {
  padding: 10px 12px;
  margin-bottom: 8px;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 13px;
  font-weight: 600;
  color: #495057;
  background: #f8f9fa;
  border: 2px solid transparent;
}

.hs-semana-item:hover {
  background: #e9ecef;
  border-color: #667eea;
}

.hs-semana-item.active {
  background: #667eea;
  color: white;
}

.hs-btn-primera-clase {
  padding: 10px 12px;
  margin-bottom: 12px;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 13px;
  font-weight: 600;
  color: #fff;
  background: linear-gradient(135deg, #f39c12 0%, #f1c40f 100%);
  border: 2px solid transparent;
  text-align: center;
}

.hs-btn-primera-clase:hover {
  background: linear-gradient(135deg, #e67e22 0%, #f39c12 100%);
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(243, 156, 18, 0.3);
}

.hs-btn-agregar-semana {
  width: 100%;
  padding: 10px;
  background: #28a745;
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  margin-top: 12px;
}

.hs-btn-agregar-semana:hover {
  background: #218838;
}

.hs-main {
  position: relative;
}

.hs-toolbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding: 16px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 8px;
  color: white;
}

.hs-nav-semana {
  display: flex;
  align-items: center;
  gap: 16px;
}

.hs-nav-btn {
  padding: 8px 16px;
  background: rgba(255,255,255,0.2);
  border: 2px solid rgba(255,255,255,0.3);
  border-radius: 6px;
  color: white;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.hs-nav-btn:hover {
  background: rgba(255,255,255,0.3);
  border-color: rgba(255,255,255,0.5);
}

.hs-semana-info {
  font-size: 16px;
  font-weight: 700;
}

.hs-actions {
  display: flex;
  gap: 8px;
}

.hs-btn-action {
  padding: 8px 16px;
  background: rgba(255,255,255,0.2);
  border: 2px solid rgba(255,255,255,0.3);
  border-radius: 6px;
  color: white;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.hs-btn-action:hover {
  background: rgba(255,255,255,0.3);
  border-color: rgba(255,255,255,0.5);
}

.hs-grid-container {
  background: #fff;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 2px 8px rgba(0,0,0,.08);
  position: relative;
  min-height: 400px;
}

.hs-grid {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
}

.hs-grid thead {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.hs-grid th {
  padding: 12px 8px;
  text-align: center;
  font-weight: 600;
  border: 1px solid rgba(255,255,255,.2);
}

.hs-grid .hs-col-hora {
  width: 80px;
  background: #f8f9fa;
  font-weight: 600;
  color: #495057;
}

.hs-grid .hs-col-dia {
  width: calc((100% - 80px) / 7);
  min-width: 100px;
}

.hs-grid td {
  padding: 4px;
  border: 1px solid #dee2e6;
  height: 45px;
  vertical-align: middle;
}

.hs-celda {
  min-height: 35px;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 500;
  font-size: 12px;
}

.hs-celda:hover {
  transform: scale(1.05);
  box-shadow: 0 2px 8px rgba(0,0,0,.15);
}

.hs-celda.ocupada {
  color: white;
  padding: 6px 8px;
}

.hs-celda.clase-fija {
  opacity: 0.6;
  font-style: italic;
}

.hs-modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,.5);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 10000;
}

.hs-modal.active {
  display: flex;
}

.hs-modal-content {
  background: white;
  border-radius: 12px;
  padding: 24px;
  width: 90%;
  max-width: 500px;
  box-shadow: 0 10px 40px rgba(0,0,0,.2);
}

.hs-modal-content h3 {
  margin: 0 0 20px;
  color: #667eea;
  font-size: 20px;
}

.hs-form-group {
  margin-bottom: 16px;
}

.hs-form-group label {
  display: block;
  margin-bottom: 6px;
  font-weight: 600;
  color: #333;
  font-size: 13px;
}

.hs-form-group input,
.hs-form-group select {
  width: 100%;
  padding: 10px 12px;
  border: 2px solid #ddd;
  border-radius: 6px;
  font-size: 14px;
  transition: border 0.3s;
  box-sizing: border-box;
}

.hs-form-group input:focus,
.hs-form-group select:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
}

.hs-modal-actions {
  display: flex;
  gap: 12px;
  margin-top: 20px;
  justify-content: flex-end;
}

.hs-btn {
  padding: 10px 20px;
  border: none;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

.hs-btn-primary {
  background: #667eea;
  color: white;
}

.hs-btn-primary:hover {
  background: #5568d3;
}

.hs-btn-secondary {
  background: #6c757d;
  color: white;
}

.hs-btn-secondary:hover {
  background: #5a6268;
}

.hs-btn-danger {
  background: #dc3545;
  color: white;
}

.hs-btn-danger:hover {
  background: #c82333;
}

.hs-loading {
  text-align: center;
  padding: 40px;
  color: #667eea;
}

.hs-spinner {
  display: inline-block;
  width: 40px;
  height: 40px;
  border: 4px solid rgba(102,126,234,.2);
  border-top-color: #667eea;
  border-radius: 50%;
  animation: hs-spin .8s linear infinite;
}

@keyframes hs-spin {
  to { transform: rotate(360deg); }
}

@media (max-width: 768px) {
  .hs-container {
    grid-template-columns: 1fr;
  }
  
  .hs-sidebar {
    border-right: none;
    border-bottom: 2px solid #e0e0e0;
    padding-right: 0;
    padding-bottom: 16px;
  }
  
  .hs-toolbar {
    flex-direction: column;
    gap: 12px;
  }
  
  .hs-grid {
    font-size: 11px;
  }
  
  .hs-grid .hs-col-hora {
    width: 60px;
  }
  
  .hs-celda {
    font-size: 10px;
    padding: 4px;
  }
}

/* === NOTIFICACIONES === */
.hs-notificacion {
  position: fixed;
  top: 20px;
  right: 20px;
  background: white;
  padding: 16px 20px;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,.15);
  display: flex;
  align-items: center;
  gap: 12px;
  z-index: 10002;
  min-width: 300px;
  animation: hs-slideIn 0.3s ease-out;
}

@keyframes hs-slideIn {
  from {
    transform: translateX(400px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

.hs-notificacion.success {
  border-left: 4px solid #28a745;
}

.hs-notificacion.error {
  border-left: 4px solid #dc3545;
}

.hs-notificacion.info {
  border-left: 4px solid #17a2b8;
}

.hs-notificacion-icon {
  font-size: 24px;
  flex-shrink: 0;
}

.hs-notificacion.success .hs-notificacion-icon {
  color: #28a745;
}

.hs-notificacion.error .hs-notificacion-icon {
  color: #dc3545;
}

.hs-notificacion.info .hs-notificacion-icon {
  color: #17a2b8;
}

.hs-notificacion-texto {
  flex: 1;
  font-size: 14px;
  font-weight: 500;
  color: #333;
}

.hs-notificacion-cerrar {
  background: none;
  border: none;
  font-size: 20px;
  color: #999;
  cursor: pointer;
  padding: 0;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.hs-notificacion-cerrar:hover {
  color: #666;
}

</style>
<!-- MOD-003: FIN -->

<!-- MOD-004: ESTRUCTURA HTML [INICIO] -->
<div class="hs-container">
  <div class="hs-sidebar">
    <h3>üìÖ Semanas</h3>
    <button class="hs-btn-primera-clase" onclick="window.hsAbrirConfigSemana()">
      1ra clase
    </button>
    <div id="hsSemanasList"></div>
    <button class="hs-btn-agregar-semana" onclick="window.hsAgregarNuevaSemana()">
      ‚ûï Agregar Semana
    </button>
  </div>
  
  <div class="hs-main">
    <div class="hs-toolbar">
      <div class="hs-nav-semana">
        <button class="hs-nav-btn" onclick="window.hsNavegarSemana(-1)">‚óÄ Ant</button>
        <div class="hs-semana-info" id="hsSemanaInfo">Semana 1</div>
        <button class="hs-nav-btn" onclick="window.hsNavegarSemana(1)">Sig ‚ñ∂</button>
      </div>
      
      <div class="hs-actions">
        <button class="hs-btn-action" onclick="window.hsCopiarSemanaAnterior()">
          üìã Copiar Sem. ant.
        </button>
        <button class="hs-btn-action" onclick="window.hsLimpiarSemana()">
          üóëÔ∏è Limpiar
        </button>
      </div>
    </div>
    
    <div class="hs-grid-container">
      <div class="hs-loading" id="loadingHS">
        <div class="hs-spinner"></div>
        <p>Cargando horario...</p>
      </div>
      <div id="hsGridContainer"></div>
    </div>
  </div>
</div>

<div id="modalConfigSemana" class="hs-modal">
  <div class="hs-modal-content">
    <h3>Configurar Semana 1</h3>
    
    <form id="formConfigSemana" onsubmit="return window.hsHandleConfigSemana(event)">
      <div class="hs-form-group">
        <label>Primer d√≠a de clases (cualquier d√≠a de la semana):</label>
        <input type="date" id="configFechaInicio" required>
      </div>
      
      <div class="hs-modal-actions">
        <button type="button" class="hs-btn hs-btn-secondary" onclick="window.hsCerrarConfigSemana()">Cancelar</button>
        <button type="submit" class="hs-btn hs-btn-primary">Guardar</button>
      </div>
    </form>
  </div>
</div>

<div id="modalActividad" class="hs-modal">
  <div class="hs-modal-content">
    <h3 id="actividadFormTitle">Agregar Actividad</h3>

    <form id="formActividad" onsubmit="return window.hsHandleSubmitActividad(event)">
      <input type="hidden" id="actividadRowNumber">
      <input type="hidden" id="actividadModoEdicion" value="false">
      <input type="hidden" id="actividadFecha">
      <input type="hidden" id="actividadSem">

      <div class="hs-form-group">
        <label>Tipo de Actividad:</label>
        <select id="actividadTipo" required>
          <option value="">Seleccionar...</option>
          <option value="Estudio">Estudio</option>
          <option value="Repaso">Repaso</option>
          <option value="Tarea">Tarea</option>
          <option value="Proyecto">Proyecto</option>
          <option value="Lectura">Lectura</option>
          <option value="Personal">Personal</option>
          <option value="Otro">Otro</option>
        </select>
      </div>

      <div class="hs-form-group">
        <label>Nombre:</label>
        <input type="text" id="actividadNombre" required placeholder="Ej: Estudio FIS">
      </div>

      <div class="hs-form-group">
        <label>Hora Inicio:</label>
        <input type="time" id="actividadHoraIni" required>
      </div>

      <div class="hs-form-group">
        <label>Hora Fin:</label>
        <input type="time" id="actividadHoraFin" required>
      </div>

      <div class="hs-form-group">
        <label>Color:</label>
        <input type="color" id="actividadColor" value="#17a2b8">
      </div>

      <div class="hs-modal-actions">
        <button type="button" class="hs-btn hs-btn-secondary" onclick="window.hsCerrarModalActividad()">Cancelar</button>
        <button type="button" class="hs-btn hs-btn-danger" id="btnEliminarActividad" style="display:none" onclick="window.hsConfirmarEliminarActividad()">Eliminar</button>
        <button type="submit" class="hs-btn hs-btn-primary" id="btnSubmitActividad">Guardar</button>
      </div>
    </form>
  </div>
</div>

<!-- V01.31 CLAUDE: Modal de confirmaci√≥n estilizado -->
<div id="modalConfirmacion" class="hs-modal">
  <div class="hs-modal-content" style="max-width: 420px;">
    <h3 id="confirmacionTitulo" style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
      <span style="font-size: 32px;">‚ùì</span>
      <span>Confirmaci√≥n</span>
    </h3>

    <p id="confirmacionMensaje" style="font-size: 15px; line-height: 1.6; color: #555; margin-bottom: 24px;">
      ¬øEst√°s seguro?
    </p>

    <div class="hs-modal-actions">
      <button type="button" class="hs-btn hs-btn-secondary" onclick="window.hsCerrarModalConfirmacion()">Cancelar</button>
      <button type="button" class="hs-btn hs-btn-primary" id="btnConfirmarAccion">Confirmar</button>
    </div>
  </div>
</div>
<!-- MOD-004: FIN  -->

<!-- MOD-005: JAVASCRIPT [INICIO] -->
<script>

// MOD-005-S01: ENCAPSULAMIENTO IIFE [INICIO]
(function () {
'use strict';

if (window.HorarioSemanalModule) {
  console.log('üìÖ HorarioSemanalModule ya existe, ignorando carga');
  return;
}

console.log('üìÖ HorarioSemanalModule V01.33 CODEWORKSHOP iniciando...');
// MOD-005-S01: FIN

// MOD-005-S02: SISTEMA DE NOTIFICACIONES [INICIO]
function mostrarNotificacion(tipo, mensaje) {
  const notif = document.createElement('div');
  notif.className = `hs-notificacion ${tipo}`;
  
  const iconos = {
    'success': '‚úì',
    'error': '‚úó',
    'info': '‚Ñπ'
  };
  
  notif.innerHTML = `
    <div class="hs-notificacion-icon">${iconos[tipo] || '‚Ñπ'}</div>
    <div class="hs-notificacion-texto">${mensaje}</div>
    <button class="hs-notificacion-cerrar" onclick="this.parentElement.remove()">√ó</button>
  `;
  
  document.body.appendChild(notif);
  
  setTimeout(() => {
    if (notif.parentElement) {
      notif.style.animation = 'hs-slideIn 0.3s ease-out reverse';
      setTimeout(() => notif.remove(), 300);
    }
  }, 4000);
}
// MOD-005-S02: FIN

// MOD-005-S03: VARIABLES Y CONSTANTES [INICIO]
let clasesData = [];
let actividadesData = [];
let cursosData = [];
let semanasData = [];
let horarioMatrix = {};
let configSemana = null;
let semanaActual = 1;
const HORA_INICIO = 7;
const HORA_FIN = 22;
const DIAS = ['Lunes','Martes','Mi√©rcoles','Jueves','Viernes','S√°bado','Domingo'];
const DIAS_CORTOS = ['Lun','Mar','Mi√©','Jue','Vie','S√°b','Dom'];
let _initDone = false;
let _retryCount = 0;
const MAX_RETRIES = 5;
// MOD-005-S03: FIN

// MOD-005-S04: INICIALIZACI√ìN [INICIO]
function init() {
  console.log('üìÖ HorarioSemanalModule.init() llamado (intento ' + (_retryCount + 1) + ')');
  
  if (_initDone) {
    console.log('üìÖ Ya inicializado, ignorando');
    return;
  }
  
  if (!window.currentUser || !currentUser.codeAlum) {
    console.warn('üìÖ currentUser no disponible, reintentando...');
    
    if (_retryCount < MAX_RETRIES) {
      _retryCount++;
      setTimeout(init, 200);
    } else {
      console.error('üìÖ currentUser no disponible despu√©s de ' + MAX_RETRIES + ' intentos');
      ocultarLoading();
    }
    return;
  }
  
  _initDone = true;
  console.log('üìÖ Inicializado para:', currentUser.codeAlum);
  
  cargarConfigSemana();
  cargarSemanas();
}
// MOD-005-S04: FIN

// MOD-005-S05: CARGA CONFIG SEMANA [INICIO]
function cargarConfigSemana() {
  console.log('üìÖ Cargando configuraci√≥n de semana...');
  
  google.script.run
    .withSuccessHandler(r => {
      console.log('üìÖ Config response:', r);
      
      if (r && r.success && r.data && r.data.FechaInicio) {
        configSemana = r.data;
        console.log('üìÖ FechaInicio:', configSemana.FechaInicio);
        
        calcularSemanaActual();
        cargarCursos();
        cargarHorarioClases();
        cargarHorarioSem();
      } else {
        console.log('üìÖ Sin configuraci√≥n, mostrar modal');
        ocultarLoading();
        abrirConfigSemana();
      }
    })
    .withFailureHandler(e => {
      console.error('üìÖ Error al cargar config:', e);
      ocultarLoading();
    })
    .studentObtenerConfigSemana({ codeAlum: currentUser.codeAlum });
}
// MOD-005-S05: FIN

// MOD-005-S06: CARGA SEMANAS [INICIO]
function cargarSemanas() {
  console.log('üìÖ Cargando semanas desde BD...');
  
  google.script.run
    .withSuccessHandler(r => {
      if (r && r.success) {
        semanasData = r.data || [];
        console.log('üìÖ Semanas cargadas:', semanasData.length);
        renderListaSemanas();
      } else {
        console.log('üìÖ Sin semanas, usar semana actual');
        renderListaSemanas();
      }
    })
    .withFailureHandler(e => {
      console.error('üìÖ Error al cargar semanas:', e);
      renderListaSemanas();
    })
    .studentObtenerSemanas({ codeAlum: currentUser.codeAlum });
}
// MOD-005-S06: FIN

// MOD-005-S07: CALCULAR SEMANA ACTUAL [INICIO]
function calcularSemanaActual() {
  const hoy = new Date();
  hoy.setHours(0, 0, 0, 0);
  
  const fechaInicio = new Date(configSemana.FechaInicio);
  fechaInicio.setHours(0, 0, 0, 0);
  
  const diffMs = hoy - fechaInicio;
  const diffDias = Math.floor(diffMs / (1000 * 60 * 60 * 24));
  
  semanaActual = Math.floor(diffDias / 7) + 1;
  
  if (semanaActual < 1) semanaActual = 1;
  
  console.log('üìÖ Semana actual:', semanaActual);
  
  renderListaSemanas();
  actualizarInfoSemana();
}
// MOD-005-S07: FIN

// MOD-005-S08: RENDER LISTA SEMANAS [INICIO]
function renderListaSemanas() {
  const lista = document.getElementById('hsSemanasList');
  if (!lista) return;
  
  let html = '';
  
  if (semanasData.length > 0) {
    semanasData.forEach(sem => {
      const numSem = parseInt(sem.Semana);
      const activeClass = numSem === semanaActual ? 'active' : '';
      html += `
        <div class="hs-semana-item ${activeClass}" onclick="window.hsCambiarSemana(${numSem})">
          Semana ${numSem}
        </div>
      `;
    });
  } else {
    for (let i = 1; i <= semanaActual; i++) {
      const activeClass = i === semanaActual ? 'active' : '';
      html += `
        <div class="hs-semana-item ${activeClass}" onclick="window.hsCambiarSemana(${i})">
          Semana ${i}
        </div>
      `;
    }
  }
  
  lista.innerHTML = html;
}
// MOD-005-S08: FIN

// MOD-005-S09: ACTUALIZAR INFO SEMANA [INICIO]
function actualizarInfoSemana() {
  const info = document.getElementById('hsSemanaInfo');
  if (!info) return;
  
  const fechas = calcularFechasSemana(semanaActual);
  const fechaIni = formatearFechaCorta(fechas.lunes);
  const fechaFin = formatearFechaCorta(fechas.domingo);
  
  info.textContent = `S${semanaActual}: ${fechaIni} - ${fechaFin}`;
}
// MOD-005-S09: FIN

// MOD-005-S10: CALCULAR FECHAS SEMANA [INICIO]
function calcularFechasSemana(numSemana) {
  const fechaInicio = new Date(configSemana.FechaInicio);
  fechaInicio.setHours(0, 0, 0, 0);
  
  const diaSemana = fechaInicio.getDay();
  const diasHastaLunes = diaSemana === 0 ? 6 : diaSemana - 1;
  
  const lunes = new Date(fechaInicio);
  lunes.setDate(lunes.getDate() - diasHastaLunes);
  lunes.setDate(lunes.getDate() + ((numSemana - 1) * 7));
  
  const domingo = new Date(lunes);
  domingo.setDate(domingo.getDate() + 6);
  
  const dias = [];
  for (let i = 0; i < 7; i++) {
    const dia = new Date(lunes);
    dia.setDate(dia.getDate() + i);
    dias.push(dia);
  }
  
  return { lunes, domingo, dias };
}
// MOD-005-S10: FIN

// MOD-005-S11: CARGA DE CURSOS [INICIO]
function cargarCursos() {
  console.log('üìÖ Cargando cursos...');
  
  google.script.run
    .withSuccessHandler(r => {
      if (r && r.success) {
        cursosData = r.data || [];
        console.log('üìÖ Cursos cargados:', cursosData.length);
      }
    })
    .withFailureHandler(e => {
      console.error('üìÖ Error al cargar cursos:', e);
    })
    .studentObtenerCursos({ codeAlum: currentUser.codeAlum });
}
// MOD-005-S11: FIN

// MOD-005-S12: CARGA HORARIO CLASES [INICIO]
function cargarHorarioClases() {
  console.log('üìÖ Cargando horario clases...');
  
  google.script.run
    .withSuccessHandler(r => {
      if (r && r.success) {
        clasesData = r.data || [];
        console.log('üìÖ Clases cargadas:', clasesData.length);
      }
    })
    .withFailureHandler(e => {
      console.error('üìÖ Error al cargar clases:', e);
    })
    .studentObtenerHorarioClases({ codeAlum: currentUser.codeAlum });
}
// MOD-005-S12: FIN

// MOD-005-S13: CARGA HORARIO SEMANAL [INICIO]
function cargarHorarioSem() {
  console.log('üìÖ Cargando horario semanal...');
  
  google.script.run
    .withSuccessHandler(r => {
      console.log('üìÖ HorarioSem response:', r);
      
      if (r && r.success) {
        actividadesData = r.data || [];
        console.log('üìÖ Actividades cargadas:', actividadesData.length);
        
        construirMatriz();
        renderGrid();
        ocultarLoading();
      } else {
        console.error('üìÖ Error en response:', r);
        construirMatriz();
        renderGrid();
        ocultarLoading();
      }
    })
    .withFailureHandler(e => {
      console.error('üìÖ Error de conexi√≥n:', e);
      construirMatriz();
      renderGrid();
      ocultarLoading();
    })
    .studentObtenerHorarioSem({ codeAlum: currentUser.codeAlum });
}
// MOD-005-S13: FIN

// MOD-005-S14: CONSTRUCCI√ìN DE MATRIZ [INICIO]
function construirMatriz() {
  console.log('üìÖ Construyendo matriz...');
  
  const fechas = calcularFechasSemana(semanaActual);
  
  horarioMatrix = {};
  fechas.dias.forEach(fecha => {
    const key = formatearFechaISO(fecha);
    horarioMatrix[key] = {};
  });
  
  clasesData.forEach(c => {
    const dia = extraerDia(c.Detalle);
    if (!dia) return;
    
    const diaIndex = DIAS.indexOf(dia);
    if (diaIndex === -1) return;
    
    const fechaDia = fechas.dias[diaIndex];
    const key = formatearFechaISO(fechaDia);
    
    const horas = calcularHoras(c.HoraIni, c.HoraFin);
    horas.forEach(h => {
      horarioMatrix[key][h.hora] = horarioMatrix[key][h.hora] || [];
      horarioMatrix[key][h.hora].push({
        tipo: 'clase',
        clase: c,
        ...h
      });
    });
  });
  
  actividadesData.forEach(act => {
    const fechaAct = act.FechaHS;
    if (!fechaAct) return;

    const fechaParsed = parsearFechaDDMMAAAA(fechaAct);
    if (isNaN(fechaParsed.getTime())) {
      console.warn('üìÖ Fecha inv√°lida:', fechaAct);
      return;
    }

    const key = formatearFechaISO(fechaParsed);

    if (!horarioMatrix[key]) return;

    const horas = calcularHoras(act.HoraInicio, act.HoraFin);
    horas.forEach(h => {
      horarioMatrix[key][h.hora] = horarioMatrix[key][h.hora] || [];
      horarioMatrix[key][h.hora].push({
        tipo: 'actividad',
        actividad: act,
        ...h
      });
    });
  });
  
  console.log('üìÖ Matriz construida:', horarioMatrix);
}
// MOD-005-S14: FIN

// MOD-005-S15: HELPERS DE PROCESAMIENTO [INICIO]
function extraerDia(t) {
  if (!t) return null;
  const s = String(t).toLowerCase().trim();
  const diaEncontrado = DIAS.find(d => {
    const dLower = d.toLowerCase();
    return s.includes(dLower) || dLower.includes(s);
  });
  return diaEncontrado || null;
}

function calcularHoras(i, f) {
  const horaIniStr = normalizarHora(i);
  const horaFinStr = normalizarHora(f);
  
  if (!horaIniStr || !horaFinStr) {
    return [];
  }
  
  const [hi, mi] = horaIniStr.split(':').map(Number);
  const [hf, mf] = horaFinStr.split(':').map(Number);
  
  const res = [];
  
  for (let h = hi; h <= hf; h++) {
    if (h > HORA_FIN) break;
    if (h === hf && mf === 0) continue;
    
    res.push({
      hora: String(h).padStart(2, '0') + ':00',
      prefijo: (h === hi && mi >= 30) ? '/' : '',
      sufijo: (h === hf && mf > 0 && mf < 60) ? '/' : ''
    });
  }
  
  return res;
}

function normalizarHora(valor) {
  if (!valor) return null;
  
  if (typeof valor === 'string') {
    const match = valor.match(/(\d{1,2}):(\d{2})/);
    if (match) {
      const h = match[1].padStart(2, '0');
      const m = match[2];
      return h + ':' + m;
    }
  }
  
  if (typeof valor === 'object' && valor !== null) {
    if ('hour' in valor && 'minute' in valor) {
      const h = String(valor.hour).padStart(2, '0');
      const m = String(valor.minute).padStart(2, '0');
      return h + ':' + m;
    }
  }
  
  return null;
}

function colorCurso(curso) {
  const c = cursosData.find(x => x.Curso === curso);
  return c ? c.Color : '#667eea';
}
// MOD-005-S15: FIN

// MOD-005-S16: RENDERIZADO DE GRID [INICIO]
function renderGrid() {
  console.log('üìÖ Renderizando grid...');
  
  const container = document.querySelector('.hs-grid-container');
  if (!container) {
    console.error('üìÖ No se encontr√≥ hs-grid-container');
    return;
  }
  
  const loading = document.getElementById('loadingHS');
  if (loading) loading.remove();
  
  const c = document.getElementById('hsGridContainer');
  if (!c) return;
  
  const fechas = calcularFechasSemana(semanaActual);
  
  let html = '<table class="hs-grid"><thead><tr><th class="hs-col-hora">Hora</th>';
  
  fechas.dias.forEach((fecha, idx) => {
    const diaCorto = DIAS_CORTOS[idx];
    const fechaCorta = formatearFechaCorta(fecha);
    html += `<th class="hs-col-dia">${diaCorto}<br>${fechaCorta}</th>`;
  });
  
  html += '</tr></thead><tbody>';
  
  for (let h = HORA_INICIO; h <= HORA_FIN; h++) {
    const k = String(h).padStart(2, '0') + ':00';
    const horaFormato = formatearHora12(h);
    
    html += `<tr><td class="hs-col-hora">${horaFormato}</td>`;
    
    fechas.dias.forEach(fecha => {
      const key = formatearFechaISO(fecha);
      const items = horarioMatrix[key][k];
      
      if (items && items.length > 0) {
        const item = items[0];
        
        if (item.tipo === 'clase') {
          const color = colorCurso(item.clase.Curso);
          const texto = item.prefijo + item.clase.Curso + item.sufijo;
          
          html += `<td><div class="hs-celda ocupada clase-fija" style="background:${color}">
            ${texto}
          </div></td>`;
        } else {
          const act = item.actividad;
          const texto = item.prefijo + act.Actividad + item.sufijo;
          
          html += `<td><div class="hs-celda ocupada" 
            style="background:${act.Color}" 
            onclick="window.hsEditarActividad('${key}','${k}')">
            ${texto}
          </div></td>`;
        }
      } else {
        html += `<td><div class="hs-celda" 
          onclick="window.hsClickCelda('${key}','${k}')">
        </div></td>`;
      }
    });
    
    html += '</tr>';
  }
  
  html += '</tbody></table>';
  c.innerHTML = html;
  
  console.log('üìÖ Grid renderizado');
}

function ocultarLoading() {
  const l = document.getElementById('loadingHS');
  if (l) l.style.display = 'none';
}
// MOD-005-S16: FIN

// MOD-005-S17: FORMATEO [INICIO]
function formatearHora12(h) {
  if (h === 12) return '12 PM';
  if (h > 12) return (h - 12) + ' PM';
  if (h === 0) return '12 AM';
  return h + ' AM';
}

function formatearFechaISO(fecha) {
  if (!fecha || !(fecha instanceof Date) || isNaN(fecha.getTime())) {
    console.error('üìÖ formatearFechaISO: fecha inv√°lida', fecha);
    return '';
  }
  
  const year = fecha.getFullYear();
  const month = String(fecha.getMonth() + 1).padStart(2, '0');
  const day = String(fecha.getDate()).padStart(2, '0');
  return `${year}-${month}-${day}`;
}

function formatearFechaCorta(fecha) {
  if (!fecha || !(fecha instanceof Date) || isNaN(fecha.getTime())) {
    console.error('üìÖ formatearFechaCorta: fecha inv√°lida', fecha);
    return '';
  }
  
  const dia = String(fecha.getDate()).padStart(2, '0');
  const mes = String(fecha.getMonth() + 1).padStart(2, '0');
  return `${dia}/${mes}`;
}

function parsearFechaDDMMAAAA(fechaStr) {
  if (!fechaStr) {
    return new Date('invalid');
  }

  if (fechaStr instanceof Date) {
    return fechaStr;
  }

  const str = String(fechaStr).trim();

  const match = str.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);
  if (match) {
    const dia = parseInt(match[1], 10);
    const mes = parseInt(match[2], 10) - 1;
    const anio = parseInt(match[3], 10);
    return new Date(anio, mes, dia);
  }

  if (str.match(/^\d{4}-\d{1,2}-\d{1,2}/)) {
    return new Date(str);
  }

  return new Date(str);
}
// MOD-005-S17: FIN

// MOD-005-S18: NAVEGACI√ìN [INICIO]
function cambiarSemana(numSemana) {
  semanaActual = numSemana;
  actualizarInfoSemana();
  renderListaSemanas();
  construirMatriz();
  renderGrid();
}

function navegarSemana(direccion) {
  const nuevaSemana = semanaActual + direccion;
  
  if (nuevaSemana < 1) return;
  
  const hoy = new Date();
  hoy.setHours(0, 0, 0, 0);
  
  const fechaInicio = new Date(configSemana.FechaInicio);
  fechaInicio.setHours(0, 0, 0, 0);
  
  const diffMs = hoy - fechaInicio;
  const diffDias = Math.floor(diffMs / (1000 * 60 * 60 * 24));
  const semanaMaxima = Math.floor(diffDias / 7) + 1;
  
  if (nuevaSemana > semanaMaxima) return;
  
  cambiarSemana(nuevaSemana);
}

function agregarNuevaSemana() {
  const nuevaSemana = semanaActual + 1;
  const fechas = calcularFechasSemana(nuevaSemana);
  
  const params = {
    codeAlum: currentUser.codeAlum,
    semana: nuevaSemana,
    fechaInicio: formatearFechaISO(fechas.lunes),
    fechaFin: formatearFechaISO(fechas.domingo)
  };
  
  console.log('üìÖ Creando semana:', params);
  
  google.script.run
    .withSuccessHandler(r => {
      if (r && r.success) {
        mostrarNotificacion('success', `Semana ${nuevaSemana} creada`);
        cargarSemanas();
        cambiarSemana(nuevaSemana);
      } else {
        mostrarNotificacion('error', r.error || 'Error al crear semana');
      }
    })
    .withFailureHandler(e => {
      console.error('Error:', e);
      mostrarNotificacion('error', 'Error de conexi√≥n');
    })
    .studentCrearSemana(params);
}
// MOD-005-S18: FIN

// MOD-005-S19: CONFIG SEMANA [INICIO]
function abrirConfigSemana() {
  const modal = document.getElementById('modalConfigSemana');
  if (!modal) return;
  
  const input = document.getElementById('configFechaInicio');
  if (input && configSemana && configSemana.FechaInicio) {
    input.value = configSemana.FechaInicio;
  }
  
  modal.classList.add('active');
}

function cerrarConfigSemana() {
  const modal = document.getElementById('modalConfigSemana');
  if (modal) modal.classList.remove('active');
}

function handleConfigSemana(event) {
  event.preventDefault();
  
  const fechaInput = document.getElementById('configFechaInicio').value;
  
  if (!fechaInput) {
    mostrarNotificacion('info', 'Ingresa una fecha');
    return false;
  }
  
  const fecha = new Date(fechaInput + 'T00:00:00');
  
  const diaSemana = fecha.getDay();
  const diasHastaLunes = diaSemana === 0 ? 6 : diaSemana - 1;
  
  const lunes = new Date(fecha);
  lunes.setDate(lunes.getDate() - diasHastaLunes);
  
  const domingo = new Date(lunes);
  domingo.setDate(domingo.getDate() + 6);
  
  const fechaInicioISO = formatearFechaISO(lunes);
  const fechaFinISO = formatearFechaISO(domingo);
  
  console.log('üìÖ Guardando config y creando Semana 1:', {
    fechaInicio: fechaInicioISO,
    fechaFin: fechaFinISO
  });
  
  google.script.run
    .withSuccessHandler(r => {
      if (r && r.success) {
        mostrarNotificacion('success', 'Configuraci√≥n guardada y Semana 1 creada');
        cerrarConfigSemana();
        location.reload();
      } else {
        mostrarNotificacion('error', 'Error al guardar: ' + (r ? r.error : 'Desconocido'));
      }
    })
    .withFailureHandler(e => {
      console.error('Error:', e);
      mostrarNotificacion('error', 'Error de conexi√≥n');
    })
    .studentGuardarConfigSemana({
      codeAlum: currentUser.codeAlum,
      fechaInicio: fechaInicioISO,
      fechaFin: fechaFinISO
    });
  
  return false;
}
// MOD-005-S19: FIN

// MOD-005-S20: FORMULARIO ACTIVIDAD [INICIO]
function clickCelda(fecha, hora) {
  console.log('üìÖ Click en celda:', { fecha, hora });
  abrirFormularioActividad(fecha, hora);
}

function abrirFormularioActividad(fecha, hora) {
  resetFormActividad();
  
  const fechaObj = new Date(fecha);
  const diaIndex = fechaObj.getDay() === 0 ? 6 : fechaObj.getDay() - 1;
  const diaCorto = DIAS_CORTOS[diaIndex];
  const fechaCorta = formatearFechaCorta(fechaObj);
  
  document.getElementById('actividadFormTitle').textContent = `Agregar Actividad - ${diaCorto} ${fechaCorta}`;
  document.getElementById('actividadModoEdicion').value = 'false';
  document.getElementById('actividadFecha').value = fecha;
  document.getElementById('actividadSem').value = semanaActual;
  document.getElementById('btnSubmitActividad').textContent = 'Guardar';
  document.getElementById('btnEliminarActividad').style.display = 'none';
  
  document.getElementById('actividadHoraIni').value = hora;
  
  const [h] = hora.split(':').map(Number);
  const horaFinSugerida = String(Math.min(h + 1, HORA_FIN + 1)).padStart(2, '0') + ':00';
  document.getElementById('actividadHoraFin').value = horaFinSugerida;
  
  document.getElementById('modalActividad').classList.add('active');
}

function editarActividad(fecha, hora) {
  const key = fecha;
  const items = horarioMatrix[key][hora];
  
  if (!items || items.length === 0) return;
  
  const item = items.find(i => i.tipo === 'actividad');
  if (!item) return;
  
  const act = item.actividad;
  
  const fechaObj = new Date(fecha);
  const diaIndex = fechaObj.getDay() === 0 ? 6 : fechaObj.getDay() - 1;
  const diaCorto = DIAS_CORTOS[diaIndex];
  const fechaCorta = formatearFechaCorta(fechaObj);
  
  document.getElementById('actividadFormTitle').textContent = `Editar Actividad - ${diaCorto} ${fechaCorta}`;
  document.getElementById('actividadRowNumber').value = act._rowNumber || '';
  document.getElementById('actividadModoEdicion').value = 'true';
  document.getElementById('actividadFecha').value = fecha;
  document.getElementById('actividadSem').value = act.Sem || semanaActual;
  document.getElementById('actividadTipo').value = act.TipoAct || '';
  document.getElementById('actividadNombre').value = act.Actividad || '';
  document.getElementById('actividadHoraIni').value = normalizarHora(act.HoraInicio) || '';
  document.getElementById('actividadHoraFin').value = normalizarHora(act.HoraFin) || '';
  document.getElementById('actividadColor').value = act.Color || '#17a2b8';
  
  document.getElementById('btnSubmitActividad').textContent = 'Actualizar';
  document.getElementById('btnEliminarActividad').style.display = 'block';
  
  document.getElementById('modalActividad').classList.add('active');
}

function resetFormActividad() {
  const form = document.getElementById('formActividad');
  if (form) form.reset();
  
  document.getElementById('actividadRowNumber').value = '';
  document.getElementById('actividadModoEdicion').value = '';
  document.getElementById('actividadFecha').value = '';
  document.getElementById('actividadSem').value = '';
}

function cerrarModalActividad() {
  const modal = document.getElementById('modalActividad');
  if (modal) modal.classList.remove('active');
  resetFormActividad();
}

function handleSubmitActividad(event) {
  event.preventDefault();
  
  const tipo = document.getElementById('actividadTipo').value.trim();
  const nombre = document.getElementById('actividadNombre').value.trim();
  const horaIni = document.getElementById('actividadHoraIni').value.trim();
  const horaFin = document.getElementById('actividadHoraFin').value.trim();
  const fechaISO = document.getElementById('actividadFecha').value;
  const sem = document.getElementById('actividadSem').value;
  const color = document.getElementById('actividadColor').value;
  const esEdicion = document.getElementById('actividadModoEdicion').value === 'true';
  const rowNumber = document.getElementById('actividadRowNumber').value;
  
  if (!tipo || !nombre || !horaIni || !horaFin) {
    mostrarNotificacion('info', 'Completa todos los campos');
    return false;
  }
  
  if (horaIni >= horaFin) {
    mostrarNotificacion('info', 'La hora de fin debe ser mayor a la de inicio');
    return false;
  }
  
  const btnSubmit = document.getElementById('btnSubmitActividad');
  btnSubmit.disabled = true;
  btnSubmit.textContent = esEdicion ? 'Actualizando...' : 'Guardando...';
  
  const params = {
    codeAlum: currentUser.codeAlum,
    actividad: nombre,
    horaInicio: horaIni,
    horaFin: horaFin,
    fechaHS: fechaISO,
    tipoAct: tipo,
    color: color,
    sem: sem
  };
  
  if (esEdicion) {
    if (rowNumber) {
      params.rowNumber = parseInt(rowNumber);
    }
    
    google.script.run
      .withSuccessHandler(r => handleActividadGuardada(r, true))
      .withFailureHandler(e => handleActividadError(e, true))
      .studentActualizarHorarioSem(params);
  } else {
    google.script.run
      .withSuccessHandler(r => handleActividadGuardada(r, false))
      .withFailureHandler(e => handleActividadError(e, false))
      .studentAgregarHorarioSem(params);
  }
  
  return false;
}

function handleActividadGuardada(response, esEdicion) {
  const btnSubmit = document.getElementById('btnSubmitActividad');
  btnSubmit.disabled = false;
  btnSubmit.textContent = esEdicion ? 'Actualizar' : 'Guardar';
  
  if (response && response.success) {
    const msg = esEdicion ? '‚úì Actividad actualizada' : '‚úì Actividad agregada';
    mostrarNotificacion('success', msg);
    cerrarModalActividad();
    cargarHorarioSem();
  } else {
    const error = response ? response.error : 'Error desconocido';
    mostrarNotificacion('error', 'Error: ' + error);
  }
}

function handleActividadError(error, esEdicion) {
  console.error('üìÖ Error:', error);
  
  const btnSubmit = document.getElementById('btnSubmitActividad');
  btnSubmit.disabled = false;
  btnSubmit.textContent = esEdicion ? 'Actualizar' : 'Guardar';
  
  mostrarNotificacion('error', 'Error de conexi√≥n. Intenta nuevamente');
}

function confirmarEliminarActividad() {
  const rowNumber = document.getElementById('actividadRowNumber').value;

  if (!rowNumber) {
    mostrarNotificacion('info', 'No se puede eliminar esta actividad');
    return;
  }

  mostrarConfirmacion(
    '¬øEliminar esta actividad?\n\nEsta acci√≥n no se puede deshacer.',
    function() {
      eliminarActividad(parseInt(rowNumber));
    }
  );
}

function eliminarActividad(rowNumber) {
  google.script.run
    .withSuccessHandler(handleActividadEliminada)
    .withFailureHandler(e => {
      console.error('üìÖ Error al eliminar:', e);
      mostrarNotificacion('error', 'Error al eliminar');
    })
    .studentEliminarHorarioSem({ rowNumber: rowNumber });
}

function handleActividadEliminada(response) {
  if (response && response.success) {
    mostrarNotificacion('success', 'Actividad eliminada');
    cerrarModalActividad();
    cargarHorarioSem();
  } else {
    const error = response ? response.error : 'Error desconocido';
    mostrarNotificacion('error', 'Error: ' + error);
  }
}
// MOD-005-S20: FIN

// MOD-005-S21: MODAL CONFIRMACI√ìN [INICIO]
function mostrarConfirmacion(mensaje, onConfirm) {
  const modal = document.getElementById('modalConfirmacion');
  const mensajeEl = document.getElementById('confirmacionMensaje');
  const btnConfirmar = document.getElementById('btnConfirmarAccion');
  
  if (!modal || !mensajeEl || !btnConfirmar) {
    console.error('‚ùå No se encontr√≥ el modal de confirmaci√≥n');
    return;
  }

  mensajeEl.innerHTML = mensaje.replace(/\n/g, '<br>');
  
  btnConfirmar.onclick = function() {
    cerrarModalConfirmacion();
    if (typeof onConfirm === 'function') {
      onConfirm();
    }
  };
  
  modal.style.display = 'flex';
}

function cerrarModalConfirmacion() {
  const modal = document.getElementById('modalConfirmacion');
  if (modal) {
    modal.style.display = 'none';
  }
}
// MOD-005-S21: FIN

// MOD-005-S22: COPIAR Y LIMPIAR [INICIO]
function copiarSemanaAnterior() {
  if (semanaActual <= 1) {
    mostrarNotificacion('info', 'No hay semana anterior para copiar');
    return;
  }

  mostrarConfirmacion(
    `¬øCopiar todas las actividades de Semana ${semanaActual - 1} a Semana ${semanaActual}?\n\nLas actividades existentes en la semana actual no se modificar√°n.`,
    function() {
      ejecutarCopiaSemana();
    }
  );
}

function ejecutarCopiaSemana() {
  const fechasOrigen = calcularFechasSemana(semanaActual - 1);
  const fechasDestino = calcularFechasSemana(semanaActual);
  
  google.script.run
    .withSuccessHandler(r => {
      if (r && r.success) {
        const cantidad = typeof r.data === 'number' ? r.data : parseInt(r.data) || 0;
        mostrarNotificacion('success', `‚úì ${cantidad} actividades copiadas`);
        cargarHorarioSem();
      } else {
        mostrarNotificacion('error', 'Error al copiar: ' + (r ? r.error : 'Desconocido'));
      }
    })
    .withFailureHandler(e => {
      console.error('Error:', e);
      mostrarNotificacion('error', 'Error de conexi√≥n');
    })
    .studentCopiarSemana({
      codeAlum: currentUser.codeAlum,
      fechaInicioOrigen: formatearFechaISO(fechasOrigen.lunes),
      fechaFinOrigen: formatearFechaISO(fechasOrigen.domingo),
      fechaInicioDestino: formatearFechaISO(fechasDestino.lunes)
    });
}

function limpiarSemana() {
  mostrarConfirmacion(
    `¬øEliminar TODAS las actividades de Semana ${semanaActual}?\n\nLas clases fijas NO se eliminar√°n.\n\nEsta acci√≥n no se puede deshacer.`,
    function() {
      ejecutarLimpiezaSemana();
    }
  );
}

function ejecutarLimpiezaSemana() {
  const fechas = calcularFechasSemana(semanaActual);
  
  google.script.run
    .withSuccessHandler(r => {
      if (r && r.success) {
        mostrarNotificacion('success', `${r.data} actividades eliminadas`);
        cargarHorarioSem();
      } else {
        mostrarNotificacion('error', 'Error: ' + (r ? r.error : 'Desconocido'));
      }
    })
    .withFailureHandler(e => {
      console.error('Error:', e);
      mostrarNotificacion('error', 'Error de conexi√≥n');
    })
    .studentLimpiarSemana({
      codeAlum: currentUser.codeAlum,
      fechaInicio: formatearFechaISO(fechas.lunes),
      fechaFin: formatearFechaISO(fechas.domingo)
    });
}
// MOD-005-S22: FIN

// MOD-005-S23: EXPOSICI√ìN GLOBAL Y ARRANQUE [INICIO]
window.hsInit = init;
window.hsCargarHorarioSem = cargarHorarioSem;
window.hsCambiarSemana = cambiarSemana;
window.hsNavegarSemana = navegarSemana;
window.hsAgregarNuevaSemana = agregarNuevaSemana;
window.hsAbrirConfigSemana = abrirConfigSemana;
window.hsCerrarConfigSemana = cerrarConfigSemana;
window.hsHandleConfigSemana = handleConfigSemana;
window.hsClickCelda = clickCelda;
window.hsEditarActividad = editarActividad;
window.hsCerrarModalActividad = cerrarModalActividad;
window.hsHandleSubmitActividad = handleSubmitActividad;
window.hsConfirmarEliminarActividad = confirmarEliminarActividad;
window.hsCopiarSemanaAnterior = copiarSemanaAnterior;
window.hsLimpiarSemana = limpiarSemana;
window.hsCerrarModalConfirmacion = cerrarModalConfirmacion;

setTimeout(function() {
  if (typeof currentUser !== 'undefined' && currentUser && currentUser.codeAlum) {
    console.log('üìÖ currentUser detectado, inicializando...');
    init();
  } else {
    console.log('üìÖ currentUser no disponible, iniciando retry...');
    init();
  }
}, 500);

window.HorarioSemanalModule = {
  init: init,
  cambiarSemana: cambiarSemana,
  navegarSemana: navegarSemana,
  abrirConfigSemana: abrirConfigSemana,
  copiarSemanaAnterior: copiarSemanaAnterior,
  limpiarSemana: limpiarSemana
};

console.log('%cüìÖ HorarioSemanalModule V01.33 CODEWORKSHOP cargado',
  'font-size:11px;color:#667eea;font-weight:bold');
// MOD-005-S23: FIN

})();

</script>
<!-- MOD-005: FIN -->

<!-- MOD-006: NOTAS [INICIO] -->
<!--
DESCRIPCI√ìN:
Grid semanal 7√ó16 (7 AM-10 PM) para actividades din√°micas por semana.
Gesti√≥n con navegaci√≥n, copia y limpieza. Clases fijas + actividades coloreadas.

FUNCIONALIDAD:
- Configuraci√≥n fecha inicio ciclo ("1ra clase")
- Navegaci√≥n por semanas calculadas autom√°ticamente
- Clases fijas (grises, desde HorarioClase)
- Actividades din√°micas (coloreadas por tipo)
- Copiar/Limpiar semanas
- Modal confirmaci√≥n estilizado

DEPENDENCIAS BACKEND:
- studentObtenerConfigSemana()
- studentGuardarConfigSemana()
- studentObtenerSemanas()
- studentCrearSemana()
- studentObtenerCursos()
- studentObtenerHorarioClases()
- studentObtenerHorarioSem()
- studentAgregarHorarioSem()
- studentActualizarHorarioSem()
- studentEliminarHorarioSem()
- studentCopiarSemana()
- studentLimpiarSemana()

ESTRUCTURA:
MOD-001: Encabezado
MOD-002: Texto libre
MOD-003: Estilos CSS
MOD-004: Estructura HTML
MOD-005: JavaScript (23 subm√≥dulos S01-S23)
MOD-006: Notas

CAMBIOS V01.32 ‚Üí V01.33:
- Remodulaci√≥n seg√∫n est√°ndar CodeWorkShop v4.0
- MOD-005 con 23 subm√≥dulos JavaScript
- Delimitadores correctos (//) dentro de <script>
- Fix: Parseo DD/MM/AAAA desde backend
- Modal confirmaci√≥n estilizado (no confirm() nativo)
- Prefijo 'hs' en funciones globales

AISLAMIENTO:
- Prefijo CSS: .hs-*
- Prefijo JS: window.hs*
- Sin conflicto con HorarioClase (.hc-*)
-->
<!-- MOD-006: FIN -->
