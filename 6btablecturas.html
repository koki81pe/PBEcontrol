<!-- MOD-001: ENCABEZADO [INICIO] -->
<!--
*****************************************
PROYECTO: PBE Control
ARCHIVO: 6btablecturas.html
VERSI√ìN: 01.24
FECHA: 20/01/2026 18:03 (UTC-5)
*****************************************
-->
<!-- MOD-001: FIN -->

<!-- MOD-002: ESTILOS [INICIO] -->
<style>
/* MOD-002-S01: RESET Y BASE [INICIO] */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
/* MOD-002-S01: FIN */

/* MOD-002-S02: CONTENEDOR PRINCIPAL [INICIO] */
.lecturas-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 20px;
}
/* MOD-002-S02: FIN */

/* MOD-002-S03: HEADER PRINCIPAL [INICIO] */
.lecturas-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  flex-wrap: wrap;
  gap: 16px;
}

.lecturas-header h2 {
  font-size: 24px;
  font-weight: 600;
  color: #333;
  display: flex;
  align-items: center;
  gap: 10px;
}

.header-actions {
  display: flex;
  gap: 12px;
  align-items: center;
  flex-wrap: wrap;
}
/* MOD-002-S03: FIN */

/* MOD-002-S04: FILTRO [INICIO] */
.filtro-container {
  display: flex;
  gap: 8px;
  align-items: center;
}

.filtro-container label {
  font-size: 14px;
  color: #666;
  font-weight: 500;
}

.filtro-container select {
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 14px;
  background: white;
  cursor: pointer;
  min-width: 180px;
}

.filtro-container select:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}
/* MOD-002-S04: FIN */

/* MOD-002-S05: BOT√ìN AGREGAR [INICIO] */
.btn-agregar {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3);
  transition: all 0.3s;
  display: flex;
  align-items: center;
  gap: 8px;
}

.btn-agregar:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.btn-agregar:active {
  transform: translateY(0);
}
/* MOD-002-S05: FIN */

/* MOD-002-S06: FORMULARIO BASE [INICIO] */
.form-lectura {
  background: white;
  border-radius: 12px;
  padding: 24px;
  margin-bottom: 20px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  display: none;
}

.form-lectura.active {
  display: block;
  animation: slideDown 0.3s ease-out;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
/* MOD-002-S06: FIN */

/* MOD-002-S07: FORM HEADER Y CIERRE [INICIO] */
.form-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 16px;
  border-bottom: 2px solid #e0e0e0;
}

.form-header h3 {
  font-size: 18px;
  font-weight: 600;
  color: #333;
}

.btn-cerrar-form {
  background: transparent;
  border: none;
  font-size: 24px;
  color: #999;
  cursor: pointer;
  padding: 0;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.2s;
}

.btn-cerrar-form:hover {
  background: #f0f0f0;
  color: #333;
}
/* MOD-002-S07: FIN */

/* MOD-002-S08: FORM LAYOUT [INICIO] */
.form-row {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px;
  margin-bottom: 16px;
}

.form-row.full-width {
  grid-template-columns: 1fr;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.form-group label {
  font-size: 14px;
  font-weight: 600;
  color: #333;
}

.form-group label .required {
  color: #dc3545;
  margin-left: 4px;
}
/* MOD-002-S08: FIN */

/* MOD-002-S09: FORM INPUTS [INICIO] */
.form-group input,
.form-group select {
  padding: 10px 12px;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 14px;
  font-family: inherit;
  transition: border-color 0.2s;
}

.form-group input:focus,
.form-group select:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.form-group input::placeholder {
  color: #999;
}

.form-group small {
  font-size: 12px;
  color: #666;
  font-style: italic;
}
/* MOD-002-S09: FIN */

/* MOD-002-S10: FORM ACTIONS [INICIO] */
.form-actions {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
  margin-top: 20px;
  padding-top: 20px;
  border-top: 1px solid #e0e0e0;
}

.btn-submit {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  padding: 10px 24px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-submit:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.btn-cancelar {
  background: #f5f5f5;
  color: #666;
  border: 1px solid #ddd;
  padding: 10px 24px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-cancelar:hover {
  background: #e8e8e8;
}
/* MOD-002-S10: FIN */

/* MOD-002-S11: TABLA CONTENEDOR [INICIO] */
.lecturas-table-container {
  background: white;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.lecturas-table {
  width: 100%;
  border-collapse: collapse;
}
/* MOD-002-S11: FIN */

/* MOD-002-S12: TABLA HEADER [INICIO] */
.lecturas-table thead {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.lecturas-table th {
  padding: 14px 16px;
  text-align: left;
  font-size: 13px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
/* MOD-002-S12: FIN */

/* MOD-002-S13: TABLA BODY [INICIO] */
.lecturas-table tbody tr {
  border-bottom: 1px solid #e0e0e0;
  transition: background 0.2s;
}

.lecturas-table tbody tr:nth-child(even) {
  background: #f8f9fa;
}

.lecturas-table tbody tr:hover {
  background: #e9ecef;
}

.lecturas-table td {
  padding: 14px 16px;
  font-size: 14px;
  color: #333;
}
/* MOD-002-S13: FIN */

/* MOD-002-S14: BADGES Y TAGS [INICIO] */
.curso-tag {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 600;
  background: #e9ecef;
  color: #495057;
}

.lectura-titulo {
  font-weight: 600;
  color: #333;
}
/* MOD-002-S14: FIN */

/* MOD-002-S15: P√ÅGS/D√çA BADGES [INICIO] */
.pags-dia {
  font-weight: 700;
  font-size: 15px;
  padding: 4px 8px;
  border-radius: 6px;
  display: inline-block;
}

.pags-dia.ok {
  color: #28a745;
  background: #d4edda;
}

.pags-dia.warning {
  color: #ffc107;
  background: #fff3cd;
}

.pags-dia.critical {
  color: #dc3545;
  background: #f8d7da;
}
/* MOD-002-S15: FIN */

/* MOD-002-S16: NOTA BADGES [INICIO] */
.nota-badge {
  display: inline-block;
  padding: 6px 12px;
  border-radius: 6px;
  font-weight: 600;
  font-size: 13px;
}

.nota-alta {
  background: #d4edda;
  color: #155724;
}

.nota-media {
  background: #fff3cd;
  color: #856404;
}

.nota-baja {
  background: #f8d7da;
  color: #721c24;
}

.nota-pendiente {
  background: #e9ecef;
  color: #6c757d;
}
/* MOD-002-S16: FIN */

/* MOD-002-S17: ACCIONES BOTONES [INICIO] */
.acciones-container {
  display: flex;
  gap: 8px;
  justify-content: flex-end;
}

.btn-icon {
  background: transparent;
  border: 1px solid #ddd;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 16px;
  transition: all 0.2s;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.btn-icon:hover {
  transform: scale(1.1);
  border-color: #667eea;
}

.btn-eliminar:hover {
  border-color: #dc3545;
  background: #fff5f5;
}
/* MOD-002-S17: FIN */

/* MOD-002-S18: ESTADOS VAC√çO/LOADING [INICIO] */
.estado-vacio,
.loading-lecturas {
  text-align: center;
  padding: 60px 20px;
  color: #999;
}

.estado-vacio-icon {
  font-size: 64px;
  margin-bottom: 16px;
}

.estado-vacio-text {
  font-size: 20px;
  font-weight: 600;
  color: #666;
  margin-bottom: 8px;
}

.estado-vacio-subtext {
  font-size: 14px;
  color: #999;
}
/* MOD-002-S18: FIN */

/* MOD-002-S19: RESPONSIVE 768PX [INICIO] */
@media (max-width: 768px) {
  .lecturas-header {
    flex-direction: column;
    align-items: stretch;
  }
  
  .header-actions {
    flex-direction: column;
  }
  
  .filtro-container {
    flex-direction: column;
    align-items: stretch;
  }
  
  .lecturas-table {
    font-size: 12px;
  }
  
  .lecturas-table th,
  .lecturas-table td {
    padding: 10px 8px;
  }
}
/* MOD-002-S19: FIN */
</style>
<!-- MOD-002: FIN -->

<!-- MOD-003: HTML ESTRUCTURA [INICIO] -->
<div class="lecturas-container">
  <!-- Header con filtro y bot√≥n agregar -->
  <div class="lecturas-header">
    <h2>
      <span>üìö</span>
      <span>Lecturas</span>
    </h2>
    <div class="header-actions">
      <div class="filtro-container">
        <label for="filtroCursoLectura">Filtrar por curso:</label>
        <select id="filtroCursoLectura" onchange="LecturasModule.aplicarFiltro()">
          <option value="">Todos los cursos</option>
        </select>
      </div>
      <button class="btn-agregar" onclick="LecturasModule.toggleFormAgregar()">
        <span>‚ûï</span>
        <span>Agregar Lectura</span>
      </button>
    </div>
  </div>

  <!-- Formulario Agregar/Editar -->
  <div id="formLectura" class="form-lectura">
    <div class="form-header">
      <h3 id="formTitulo">Agregar Lectura</h3>
      <button class="btn-cerrar-form" onclick="LecturasModule.cancelarFormulario()" type="button">‚úï</button>
    </div>

    <form onsubmit="LecturasModule.handleSubmitLectura(event)">
      <input type="hidden" id="lectura_rowNumber" value="">

      <div class="form-row">
        <div class="form-group">
          <label for="lectura_curso">
            Curso
            <span class="required">*</span>
          </label>
          <select id="lectura_curso" required>
            <option value="">Seleccionar curso...</option>
          </select>
        </div>

        <div class="form-group">
          <label for="lectura_titulo">
            T√≠tulo de la Lectura
            <span class="required">*</span>
          </label>
          <input type="text" id="lectura_titulo" placeholder="Ej: El Principito" required>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="lectura_cantPag">
            Total de P√°ginas
            <span class="required">*</span>
          </label>
          <input type="number" id="lectura_cantPag" min="1" placeholder="Ej: 120" required>
        </div>

        <div class="form-group">
          <label for="lectura_pagActual">
            P√°ginas Le√≠das
            <span class="required">*</span>
          </label>
          <input type="number" id="lectura_pagActual" min="0" value="0" required>
          <small>P√°ginas ya le√≠das hasta ahora</small>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="lectura_fechaInicio">
            Fecha de Inicio
            <span class="required">*</span>
          </label>
          <input type="text" id="lectura_fechaInicio" placeholder="DD/MM/AAAA" required>
        </div>

        <div class="form-group">
          <label for="lectura_fechaFin">
            Fecha de Finalizaci√≥n
            <span class="required">*</span>
          </label>
          <input type="text" id="lectura_fechaFin" placeholder="DD/MM/AAAA" required>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="lectura_fechaEval">Fecha de Evaluaci√≥n</label>
          <input type="text" id="lectura_fechaEval" placeholder="DD/MM/AAAA">
          <small>Opcional</small>
        </div>

        <div class="form-group">
          <label for="lectura_nota">Nota</label>
          <input type="number" id="lectura_nota" min="0" max="20" step="0.1" placeholder="0-20">
          <small>Opcional</small>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="lectura_peso">Peso (%)</label>
          <input type="number" id="lectura_peso" min="0" max="100" placeholder="0-100">
          <small>Opcional</small>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn-cancelar" onclick="LecturasModule.cancelarFormulario()">
          Cancelar
        </button>
        <button type="submit" class="btn-submit" id="btnSubmit">
          Guardar Lectura
        </button>
      </div>
    </form>
  </div>

  <!-- Loading -->
  <div id="loadingLecturas" class="loading-lecturas" style="display: none;">
    <div class="estado-vacio-icon">‚è≥</div>
    <div class="estado-vacio-text">Cargando lecturas...</div>
  </div>

  <!-- Estado Vac√≠o -->
  <div id="estadoVacio" class="estado-vacio" style="display: none;">
    <div class="estado-vacio-icon">üìö</div>
    <div class="estado-vacio-text">No hay lecturas registradas</div>
    <div class="estado-vacio-subtext">Haz clic en "Agregar Lectura" para comenzar</div>
  </div>

  <!-- Tabla de Lecturas -->
  <div id="tablaLecturas" class="lecturas-table-container" style="display: none;">
    <table class="lecturas-table">
      <thead>
        <tr>
          <th>CURSO</th>
          <th>LECTURA</th>
          <th>P√ÅGS/D√çA</th>
          <th>P√ÅGINAS</th>
          <th>FECHA EVAL</th>
          <th>NOTA</th>
          <th>PESO</th>
          <th style="text-align: center;">ACCIONES</th>
        </tr>
      </thead>
      <tbody id="tbodyLecturas">
        <!-- Contenido din√°mico -->
      </tbody>
    </table>
  </div>
</div>
<!-- MOD-003: FIN -->

<!-- MOD-004: JAVASCRIPT [INICIO] -->
<script>
(function() {
  'use strict';
// MOD-004-S01: VARIABLES GLOBALES [INICIO]
  let lecturasData = [];
  let cursosData = [];
  let filtroActual = '';
  let modoEdicion = false;
  let _initDone = false;
// MOD-004-S01: FIN

// MOD-004-S02: INICIALIZACI√ìN [INICIO]
  function inicializar() {
    if (_initDone) {
      console.log('üìñ Ya inicializado, saltando...');
      return;
    }

    console.log('üìñ Inicializando LecturasModule V01.22 FIXED...');

    if (typeof currentUser === 'undefined' || !currentUser || !currentUser.codeAlum) {
      console.warn('üìñ currentUser no disponible, reintentando en 200ms...');
      setTimeout(inicializar, 200);
      return;
    }

    _initDone = true;
    console.log('üìñ currentUser detectado:', currentUser.codeAlum);
    cargarCursos();
    cargarLecturas();
  }
// MOD-004-S02: FIN

// MOD-004-S03: CARGAR CURSOS GAS [INICIO]
  function cargarCursos() {
    if (typeof google === 'undefined' || !google.script || !google.script.run) {
      console.warn('üìñ Google Apps Script no disponible');
      return;
    }

    google.script.run
      .withSuccessHandler(function(response) {
        if (!response || response.success !== true || !Array.isArray(response.data)) {
          console.error('üìñ Error al cargar cursos:', response);
          return;
        }

        cursosData = response.data;
        console.log('üìñ Cursos cargados:', cursosData.length);
        poblarSelectCursos();
      })
      .withFailureHandler(function(error) {
        console.error('üìñ Error al cargar cursos:', error);
      })
      .studentObtenerCursos({ codeAlum: currentUser.codeAlum });
  }
// MOD-004-S03: FIN

// MOD-004-S04: POBLAR SELECTS [INICIO]
  function poblarSelectCursos() {
    const selectCurso = document.getElementById('lectura_curso');
    const selectFiltro = document.getElementById('filtroCursoLectura');

    if (!selectCurso || !selectFiltro) return;

    selectCurso.innerHTML = '<option value="">Seleccionar curso...</option>';
    selectFiltro.innerHTML = '<option value="">Todos los cursos</option>';

    cursosData.forEach(function(curso) {
      const nombreCurso = String(curso.Curso || '').trim();
      if (!nombreCurso) return;

      const optCurso = document.createElement('option');
      optCurso.value = nombreCurso;
      optCurso.textContent = nombreCurso;
      selectCurso.appendChild(optCurso);

      const optFiltro = document.createElement('option');
      optFiltro.value = nombreCurso;
      optFiltro.textContent = nombreCurso;
      selectFiltro.appendChild(optFiltro);
    });
  }
// MOD-004-S04: FIN

// MOD-004-S05: CARGAR LECTURAS GAS [INICIO]
  function cargarLecturas() {
    mostrarLoading();

    if (typeof google === 'undefined' || !google.script || !google.script.run) {
      console.warn('üìñ Google Apps Script no disponible');
      mostrarError('Sistema no disponible');
      return;
    }

    google.script.run
      .withSuccessHandler(function(response) {
        ocultarLoading();

        if (!response || response.success !== true) {
          console.error('üìñ Error al cargar lecturas:', response);
          mostrarError('Error al cargar lecturas');
          return;
        }

        lecturasData = Array.isArray(response.data) ? response.data : [];
        console.log('üìñ Lecturas cargadas:', lecturasData.length);
        
        lecturasData = lecturasData.map(calcularPagsDia);
        renderizarTabla();
      })
      .withFailureHandler(function(error) {
        ocultarLoading();
        console.error('üìñ Error:', error);
        mostrarError('Error de conexi√≥n');
      })
      .studentObtenerLecturas({ codeAlum: currentUser.codeAlum });
  }
// MOD-004-S05: FIN

// MOD-004-S06: C√ÅLCULO P√ÅGS/D√çA [INICIO]
  function calcularPagsDia(lectura) {
    const hoy = new Date(2026, 0, 20);
    const fInicio = parseFecha(lectura.FechaInicio);
    const fFin = parseFecha(lectura.FechaFin);
    const cantPag = safeInt(lectura.CantPag, 0);
    const pagActual = safeInt(lectura.PagActual, 0);
    
    const pagsPendientes = Math.max(0, cantPag - pagActual);
    const inicioReal = new Date(Math.max(hoy, fInicio));
    const diasDisponibles = Math.ceil((fFin - inicioReal) / (1000 * 60 * 60 * 24));
    
    if (diasDisponibles > 0 && pagsPendientes > 0) {
      lectura.pagsDia = (pagsPendientes / diasDisponibles).toFixed(1);
    } else {
      lectura.pagsDia = '0.0';
    }
    
    return lectura;
  }
// MOD-004-S06: FIN

// MOD-004-S07: PARSE FECHA [INICIO]
  function parseFecha(fechaStr) {
    if (!fechaStr || typeof fechaStr !== 'string') return new Date();
    
    const partes = fechaStr.split('/');
    if (partes.length !== 3) return new Date();
    
    const dia = parseInt(partes[0], 10);
    const mes = parseInt(partes[1], 10) - 1;
    const anio = parseInt(partes[2], 10);
    
    const fecha = new Date(anio, mes, dia);
    
    if (fecha.getFullYear() !== anio || 
        fecha.getMonth() !== mes || 
        fecha.getDate() !== dia) {
      return new Date();
    }
    
    return fecha;
  }
// MOD-004-S07: FIN

// MOD-004-S08: RENDER TABLA [INICIO]
  function renderizarTabla() {
    const tabla = document.getElementById('tablaLecturas');
    const tbody = document.getElementById('tbodyLecturas');
    const estadoVacio = document.getElementById('estadoVacio');

    if (!tabla || !tbody || !estadoVacio) return;

    let lecturasFiltradas = lecturasData;
    if (filtroActual && filtroActual !== '' && filtroActual.toLowerCase() !== 'todos') {
      lecturasFiltradas = lecturasData.filter(function(l) {
        return String(l.Curso || '').trim().toUpperCase() === filtroActual.toUpperCase();
      });
    }

    if (lecturasFiltradas.length === 0) {
      tabla.style.display = 'none';
      estadoVacio.style.display = 'block';
      
      if (filtroActual && filtroActual !== '') {
        const subtext = estadoVacio.querySelector('.estado-vacio-subtext');
        if (subtext) subtext.textContent = 'No hay lecturas para el curso "' + filtroActual + '"';
      }
      return;
    }

    estadoVacio.style.display = 'none';
    tabla.style.display = 'block';

    tbody.innerHTML = lecturasFiltradas.map(function(lectura) {
      const curso = escHtml(lectura.Curso || '');
      const titulo = escHtml(lectura.Lectura || '');
      const cantPag = escHtml(lectura.CantPag || '0');
      const pagActual = escHtml(lectura.PagActual || '0');
      const fechaEval = escHtml(lectura.FechaEval || '-');
      const nota = lectura.Nota && String(lectura.Nota).trim() !== '' ? escHtml(lectura.Nota) : '-';
      const peso = lectura.Peso && String(lectura.Peso).trim() !== '' ? escHtml(lectura.Peso) + '%' : '-';
      const rowNumber = lectura._rowNumber || 0;
      
      const pagsDia = lectura.pagsDia || '0.0';
      const pagsDiaNum = parseFloat(pagsDia);
      let clasePagsDia = 'ok';
      if (pagsDiaNum >= 20) clasePagsDia = 'critical';
      else if (pagsDiaNum >= 10) clasePagsDia = 'warning';
      
      const claseNota = obtenerClaseNota(nota);
      const notaBadge = nota !== '-' 
        ? '<span class="nota-badge ' + claseNota + '">' + nota + '</span>'
        : '<span class="nota-badge nota-pendiente">-</span>';

      return `
        <tr>
          <td><span class="curso-tag">${curso}</span></td>
          <td><span class="lectura-titulo">${titulo}</span></td>
          <td><span class="pags-dia ${clasePagsDia}">${pagsDia}</span></td>
          <td>${pagActual} / ${cantPag}</td>
          <td>${fechaEval}</td>
          <td>${notaBadge}</td>
          <td>${peso}</td>
          <td>
            <div class="acciones-container">
              <button class="btn-icon" onclick="LecturasModule.editarLectura(${rowNumber})" title="Editar">‚úèÔ∏è</button>
              <button class="btn-icon btn-eliminar" onclick="LecturasModule.eliminarLectura(${rowNumber})" title="Eliminar">üóëÔ∏è</button>
            </div>
          </td>
        </tr>
      `;
    }).join('');
  }
// MOD-004-S08: FIN

// MOD-004-S09: FILTRO [INICIO]
  function aplicarFiltro() {
    const select = document.getElementById('filtroCursoLectura');
    if (!select) return;

    const valor = String(select.value || '').trim();
    filtroActual = (valor === '' || valor.toLowerCase() === 'todos') ? '' : valor;
    
    console.log('üìñ Aplicando filtro:', filtroActual || 'TODOS');
    renderizarTabla();
  }
// MOD-004-S09: FIN

// MOD-004-S10: FORM TOGGLE [INICIO]
  function toggleFormAgregar() {
    const form = document.getElementById('formLectura');
    const titulo = document.getElementById('formTitulo');
    const btn = document.getElementById('btnSubmit');

    if (!form) return;

    modoEdicion = false;
    
    if (titulo) titulo.textContent = 'Agregar Lectura';
    if (btn) btn.textContent = 'Guardar Lectura';

    limpiarFormulario();
    form.classList.toggle('active');

    if (form.classList.contains('active')) {
      const selectCurso = document.getElementById('lectura_curso');
      if (selectCurso) setTimeout(function() { selectCurso.focus(); }, 100);
    }
  }

  function cancelarFormulario() {
    const form = document.getElementById('formLectura');
    if (form) form.classList.remove('active');
    limpiarFormulario();
  }
// MOD-004-S10: FIN

// MOD-004-S11: FORM LIMPIAR [INICIO]
  function limpiarFormulario() {
    setValue('lectura_rowNumber', '');
    setValue('lectura_curso', '');
    setValue('lectura_titulo', '');
    setValue('lectura_cantPag', '');
    setValue('lectura_pagActual', '0');
    setValue('lectura_fechaInicio', '');
    setValue('lectura_fechaFin', '');
    setValue('lectura_fechaEval', '');
    setValue('lectura_nota', '');
    setValue('lectura_peso', '');
  }
// MOD-004-S11: FIN

// MOD-004-S12: FORM SUBMIT [INICIO]
  function handleSubmitLectura(event) {
    if (event && typeof event.preventDefault === 'function') {
      event.preventDefault();
    }

    const curso = getValueTrim('lectura_curso');
    const titulo = getValueTrim('lectura_titulo');
    const cantPag = getValueTrim('lectura_cantPag');
    const pagActual = getValueTrim('lectura_pagActual');
    const fechaInicio = getValueTrim('lectura_fechaInicio');
    const fechaFin = getValueTrim('lectura_fechaFin');
    const fechaEval = getValueTrim('lectura_fechaEval');
    const nota = getValueTrim('lectura_nota');
    const peso = getValueTrim('lectura_peso');
    const rowNumber = getValueTrim('lectura_rowNumber');

    if (!curso || !titulo || !cantPag || !fechaInicio || !fechaFin) {
      showAlertSafe('error', 'Por favor completa todos los campos obligatorios');
      return;
    }

    if (!validarFecha(fechaInicio)) {
      showAlertSafe('error', 'Fecha de inicio inv√°lida (DD/MM/AAAA)');
      return;
    }

    if (!validarFecha(fechaFin)) {
      showAlertSafe('error', 'Fecha de finalizaci√≥n inv√°lida (DD/MM/AAAA)');
      return;
    }

    if (fechaEval && !validarFecha(fechaEval)) {
      showAlertSafe('error', 'Fecha de evaluaci√≥n inv√°lida (DD/MM/AAAA)');
      return;
    }

    const cantPagNum = safeInt(cantPag, 0);
    const pagActualNum = safeInt(pagActual, 0);

    if (cantPagNum <= 0) {
      showAlertSafe('error', 'El total de p√°ginas debe ser mayor a 0');
      return;
    }

    if (pagActualNum < 0 || pagActualNum > cantPagNum) {
      showAlertSafe('error', 'Las p√°ginas le√≠das deben estar entre 0 y ' + cantPagNum);
      return;
    }

    const params = {
      codeAlum: currentUser.codeAlum,
      curso: curso,
      lectura: titulo,
      cantPag: cantPag,
      pagActual: pagActual,
      fechaInicio: fechaInicio,
      fechaFin: fechaFin,
      fechaEval: fechaEval,
      nota: nota,
      peso: peso,
      sem: ''
    };

    if (modoEdicion && rowNumber) {
      params.rowNumber = safeInt(rowNumber, 0);
      actualizarLectura(params);
    } else {
      agregarLectura(params);
    }
  }
// MOD-004-S12: FIN

// MOD-004-S13: AGREGAR LECTURA [INICIO]
  function agregarLectura(params) {
    google.script.run
      .withSuccessHandler(function(response) {
        if (!response || response.success !== true) {
          console.error('üìñ Error al agregar:', response);
          showAlertSafe('error', 'No se pudo agregar la lectura');
          return;
        }

        showAlertSafe('success', '‚úì Lectura agregada correctamente');
        cancelarFormulario();
        cargarLecturas();
      })
      .withFailureHandler(function(error) {
        console.error('üìñ Error:', error);
        showAlertSafe('error', 'Error de conexi√≥n al agregar lectura');
      })
      .studentAgregarLectura(params);
  }
// MOD-004-S13: FIN

// MOD-004-S14: ACTUALIZAR LECTURA [INICIO]
  function actualizarLectura(params) {
    google.script.run
      .withSuccessHandler(function(response) {
        if (!response || response.success !== true) {
          console.error('üìñ Error al actualizar:', response);
          showAlertSafe('error', 'No se pudo actualizar la lectura');
          return;
        }

        showAlertSafe('success', '‚úì Lectura actualizada correctamente');
        cancelarFormulario();
        cargarLecturas();
      })
      .withFailureHandler(function(error) {
        console.error('üìñ Error:', error);
        showAlertSafe('error', 'Error de conexi√≥n al actualizar lectura');
      })
      .studentActualizarLectura(params);
  }
// MOD-004-S14: FIN

// MOD-004-S15: EDITAR LECTURA [INICIO]
  function editarLectura(rowNumber) {
    const rn = safeInt(rowNumber, 0);
    if (!Number.isFinite(rn) || rn <= 0) {
      showAlertSafe('error', 'No se pudo editar la lectura');
      return;
    }

    const lectura = lecturasData.find(function(l) {
      return safeInt(l && l._rowNumber != null ? l._rowNumber : 0, 0) === rn;
    });

    if (!lectura) {
      showAlertSafe('error', 'Lectura no encontrada');
      return;
    }

    modoEdicion = true;

    setValue('lectura_rowNumber', rn);
    setValue('lectura_curso', lectura.Curso || '');
    setValue('lectura_titulo', lectura.Lectura || '');
    setValue('lectura_cantPag', lectura.CantPag || '');
    setValue('lectura_pagActual', lectura.PagActual || '0');
    setValue('lectura_fechaInicio', lectura.FechaInicio || '');
    setValue('lectura_fechaFin', lectura.FechaFin || '');
    setValue('lectura_fechaEval', lectura.FechaEval || '');
    setValue('lectura_nota', lectura.Nota || '');
    setValue('lectura_peso', lectura.Peso || '');

    const titulo = document.getElementById('formTitulo');
    const btn = document.getElementById('btnSubmit');
    if (titulo) titulo.textContent = 'Editar Lectura';
    if (btn) btn.textContent = 'Actualizar Lectura';

    const formWrap = document.getElementById('formLectura');
    if (formWrap) formWrap.classList.add('active');

    if (formWrap && typeof formWrap.scrollIntoView === 'function') {
      formWrap.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }
// MOD-004-S15: FIN

// MOD-004-S16: ELIMINAR LECTURA [INICIO]
  function eliminarLectura(rowNumber) {
    const rn = safeInt(rowNumber, 0);
    if (!Number.isFinite(rn) || rn <= 0) {
      showAlertSafe('error', 'No se pudo eliminar la lectura');
      return;
    }

    const lectura = lecturasData.find(function(l) {
      return safeInt(l && l._rowNumber != null ? l._rowNumber : 0, 0) === rn;
    });

    const nombreLectura = lectura && lectura.Lectura ? String(lectura.Lectura) : 'esta lectura';

    if (!confirm('¬øEliminar "' + nombreLectura + '"?\nEsta acci√≥n no se puede deshacer.')) return;

    google.script.run
      .withSuccessHandler(function(response) {
        if (!response || response.success !== true) {
          console.error('üìñ Error eliminar:', response);
          showAlertSafe('error', 'No se pudo eliminar la lectura');
          return;
        }
        showAlertSafe('success', '‚úì Lectura eliminada correctamente');
        cargarLecturas();
      })
      .withFailureHandler(function(error) {
        console.error('üìñ Error al eliminar:', error);
        showAlertSafe('error', 'Error de conexi√≥n al eliminar lectura');
      })
      .studentEliminarLectura({ rowNumber: rn });
  }
// MOD-004-S16: FIN

// MOD-004-S17: HELPERS VALIDACI√ìN [INICIO]
  function obtenerClaseNota(nota) {
    if (nota == null || String(nota).trim() === '' || nota === '-') return 'nota-pendiente';
    const n = safeFloat(nota, NaN);
    if (!Number.isFinite(n)) return 'nota-pendiente';
    if (n >= 14) return 'nota-alta';
    if (n >= 11) return 'nota-media';
    return 'nota-baja';
  }

  function validarFecha(fecha) {
    if (!fecha) return false;

    const str = String(fecha).trim();
    const regex = /^\d{2}\/\d{2}\/\d{4}$/;
    if (!regex.test(str)) return false;

    const partes = str.split('/');
    const dia = safeInt(partes[0], 0);
    const mes = safeInt(partes[1], 0);
    const anio = safeInt(partes[2], 0);

    if (mes < 1 || mes > 12) return false;
    if (dia < 1 || dia > 31) return false;
    if (anio < 2000 || anio > 2100) return false;

    return true;
  }
// MOD-004-S17: FIN

// MOD-004-S18: HELPERS DOM [INICIO]
  function getValueTrim(id) {
    const el = document.getElementById(id);
    return el && el.value != null ? String(el.value).trim() : '';
  }

  function setValue(id, value) {
    const el = document.getElementById(id);
    if (!el) return;
    el.value = value != null ? String(value) : '';
  }

  function safeInt(value, fallback) {
    const n = parseInt(value, 10);
    return Number.isFinite(n) ? n : fallback;
  }

  function safeFloat(value, fallback) {
    const n = parseFloat(value);
    return Number.isFinite(n) ? n : fallback;
  }

  function escHtml(str) {
    const s = str == null ? '' : String(str);
    return s
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#39;');
  }
// MOD-004-S18: FIN

// MOD-004-S19: UI HELPERS [INICIO]
  function mostrarLoading() {
    const loading = document.getElementById('loadingLecturas');
    const tabla = document.getElementById('tablaLecturas');
    const vacio = document.getElementById('estadoVacio');

    if (loading) loading.style.display = 'block';
    if (tabla) tabla.style.display = 'none';
    if (vacio) vacio.style.display = 'none';
  }

  function ocultarLoading() {
    const loading = document.getElementById('loadingLecturas');
    if (loading) loading.style.display = 'none';
  }

  function mostrarError(mensaje) {
    const estadoVacio = document.getElementById('estadoVacio');
    const tabla = document.getElementById('tablaLecturas');
    const loading = document.getElementById('loadingLecturas');

    if (loading) loading.style.display = 'none';
    if (tabla) tabla.style.display = 'none';

    if (!estadoVacio) return;

    const icon = estadoVacio.querySelector('.estado-vacio-icon');
    const text = estadoVacio.querySelector('.estado-vacio-text');
    const sub = estadoVacio.querySelector('.estado-vacio-subtext');

    estadoVacio.style.display = 'block';
    if (icon) icon.textContent = '‚ö†Ô∏è';
    if (text) text.textContent = 'Error';
    if (sub) sub.textContent = mensaje;
  }
// MOD-004-S19: FIN

// MOD-004-S20: ALERTAS [INICIO]
  function showAlertSafe(type, message) {
    if (typeof showAlert === 'function') {
      showAlert(type, message);
      return;
    }
    if (type === 'error') console.error(message);
    else console.log(message);
  }

  if (typeof showAlert === 'undefined') {
    window.showAlert = function(type, message) {
      const alertBox = document.createElement('div');
      alertBox.className = 'alert alert-' + type;
      alertBox.textContent = message;
      alertBox.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 16px 24px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 9999;
        font-size: 14px;
        font-weight: 500;
        animation: slideIn 0.3s;
        ${type === 'success' ? 'background: #d4edda; color: #155724; border-left: 4px solid #28a745;' : ''}
        ${type === 'error' ? 'background: #f8d7da; color: #721c24; border-left: 4px solid #dc3545;' : ''}
        ${type === 'warning' ? 'background: #fff3cd; color: #856404; border-left: 4px solid #ffc107;' : ''}
        ${type === 'info' ? 'background: #d1ecf1; color: #0c5460; border-left: 4px solid #17a2b8;' : ''}
      `;

      document.body.appendChild(alertBox);

      setTimeout(function() { alertBox.remove(); }, 4000);
    };

    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
    `;
    document.head.appendChild(style);
  }
// MOD-004-S20: FIN

// MOD-004-S21: API P√öBLICA [INICIO]
  console.log('%cüìñ LecturasModule V01.22 FIXED cargado', 'font-size:11px;color:#667eea;font-weight:bold');

  window.LecturasModule = {
    inicializar: inicializar,
    aplicarFiltro: aplicarFiltro,
    toggleFormAgregar: toggleFormAgregar,
    handleSubmitLectura: handleSubmitLectura,
    editarLectura: editarLectura,
    eliminarLectura: eliminarLectura,
    cancelarFormulario: cancelarFormulario,
    recargar: cargarLecturas
  };
// MOD-004-S21: FIN

// MOD-004-S22: AUTO-INIT [INICIO]
  setTimeout(function() {
    if (typeof currentUser !== 'undefined' && currentUser && currentUser.codeAlum) {
      console.log('üìñ currentUser detectado, auto-inicializando...');
      inicializar();
    } else {
      console.log('üìñ currentUser no disponible, iniciando retry logic...');
      inicializar();
    }
  }, 150);
// MOD-004-S22: FIN
})();
</script>
<!-- MOD-004: FIN -->

<!-- MOD-099: NOTAS [INICIO] -->
<!--
DESCRIPCI√ìN:
Sub-tab del m√≥dulo "Deberes" que gestiona lecturas acad√©micas con seguimiento
de progreso y c√°lculo din√°mico de p√°ginas/d√≠a para planificaci√≥n de lectura.

ESTRUCTURA MODULAR (CodeWorkShop v5.0):
‚îú‚îÄ‚îÄ MOD-001: Encabezado y metadata
‚îú‚îÄ‚îÄ MOD-002: Estilos CSS (19 subm√≥dulos)
‚îú‚îÄ‚îÄ MOD-003: HTML estructura
‚îú‚îÄ‚îÄ MOD-004: JavaScript principal (22 subm√≥dulos - IIFE autocontenido)
‚îî‚îÄ‚îÄ MOD-099: Documentaci√≥n t√©cnica

CAMBIOS V01.23 ‚Üí V01.24:
‚úÖ Submodulaci√≥n completa de MOD-002 (CSS en 19 secciones)
‚úÖ Submodulaci√≥n completa de MOD-004 (JS en 22 secciones)
‚úÖ MOD-005 eliminado (LecturasHelpers innecesario - funciones en MOD-004)
‚úÖ Optimizaci√≥n de documentaci√≥n MOD-099

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

MOD-002: ESTRUCTURA CSS (19 subm√≥dulos)
S01: Reset/Base ‚Üí S02: Contenedor ‚Üí S03: Header ‚Üí S04: Filtro ‚Üí S05: Bot√≥n Agregar
S06-S10: Formulario completo ‚Üí S11-S13: Tabla ‚Üí S14-S18: Badges/Estados ‚Üí S19: Responsive

MOD-004: ESTRUCTURA JAVASCRIPT (22 subm√≥dulos)
‚îå‚îÄ INICIALIZACI√ìN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ S01: Variables globales (estado del m√≥dulo)         ‚îÇ
‚îÇ S02: Inicializaci√≥n con retry logic                 ‚îÇ
‚îú‚îÄ BACKEND I/O ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ S03: Cargar cursos (GAS)                            ‚îÇ
‚îÇ S04: Poblar selects (UI update)                     ‚îÇ
‚îÇ S05: Cargar lecturas (GAS)                          ‚îÇ
‚îú‚îÄ L√ìGICA DE NEGOCIO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ S06: C√°lculo P√°gs/D√≠a (CR√çTICO - ver f√≥rmula)      ‚îÇ
‚îÇ S07: Parse fecha DD/MM/AAAA ‚Üí Date object          ‚îÇ
‚îú‚îÄ RENDERING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ S08: Renderizar tabla (template literal)           ‚îÇ
‚îÇ S09: Aplicar filtro por curso                       ‚îÇ
‚îú‚îÄ FORMULARIO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ S10: Toggle form (abrir/cerrar)                     ‚îÇ
‚îÇ S11: Limpiar campos                                 ‚îÇ
‚îÇ S12: Submit + validaciones (70 l√≠neas)             ‚îÇ
‚îú‚îÄ CRUD OPERATIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ S13: Agregar lectura (GAS)                          ‚îÇ
‚îÇ S14: Actualizar lectura (GAS)                       ‚îÇ
‚îÇ S15: Editar lectura (populate form)                 ‚îÇ
‚îÇ S16: Eliminar lectura (GAS + confirm)              ‚îÇ
‚îú‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ S17: Validaci√≥n (nota, fecha)                       ‚îÇ
‚îÇ S18: DOM utils (getValue, setValue, safe*, escHtml) ‚îÇ
‚îÇ S19: UI states (loading, error)                     ‚îÇ
‚îÇ S20: Sistema de alertas (wrapper + fallback)       ‚îÇ
‚îú‚îÄ EXPORTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ S21: API p√∫blica (window.LecturasModule)           ‚îÇ
‚îÇ S22: Auto-init (150ms delay)                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

L√ìGICA CR√çTICA - C√ÅLCULO P√ÅGS/D√çA (S06):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Fecha hoy: 20/01/2026 (hardcoded en calcularPagsDia)‚îÇ
‚îÇ                                                       ‚îÇ
‚îÇ pagsPendientes = CantPag - PagActual                 ‚îÇ
‚îÇ inicioReal = MAX(hoy, FechaInicio)                   ‚îÇ
‚îÇ diasDisponibles = ‚åà(FechaFin - inicioReal) / 86400s‚åâ‚îÇ
‚îÇ pagsDia = pagsPendientes √∑ diasDisponibles           ‚îÇ
‚îÇ                                                       ‚îÇ
‚îÇ Colores sem√°foro:                                    ‚îÇ
‚îÇ ‚Ä¢ Verde (ok): < 10 p√°gs/d√≠a                          ‚îÇ
‚îÇ ‚Ä¢ Amarillo (warning): 10-19 p√°gs/d√≠a                 ‚îÇ
‚îÇ ‚Ä¢ Rojo (critical): ‚â• 20 p√°gs/d√≠a                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

VALIDACIONES CR√çTICAS (S12 + S17):
- Campos obligatorios: curso, lectura, cantPag, fechaInicio, fechaFin
- Formato fecha: /^\d{2}\/\d{2}\/\d{4}$/ (DD/MM/AAAA)
- Rango p√°ginas: 0 ‚â§ PagActual ‚â§ CantPag
- Nota: 0-20 (opcional) | Peso: 0-100% (opcional)

BACKEND DEPENDENCIES (Google Apps Script):
- studentObtenerCursos({ codeAlum })
- studentObtenerLecturas({ codeAlum })
- studentAgregarLectura({ codeAlum, curso, lectura, cantPag, pagActual, 
    fechaInicio, fechaFin, fechaEval, nota, peso, sem })
- studentActualizarLectura({ ...params, rowNumber })
- studentEliminarLectura({ rowNumber })

COLUMNAS TABLA (8 totales):
CURSO | LECTURA | P√ÅGS/D√çA | P√ÅGINAS | FECHA EVAL | NOTA | PESO | ACCIONES
  Tag    T√≠tulo    Badge    X/Y      DD/MM/AAAA   Badge   %    ‚úèÔ∏èüóëÔ∏è

NOTA PARA IA:
- El m√≥dulo es autocontenido (IIFE) - NO depende de MOD-005
- parseFecha() est√° en MOD-004-S07, no en helpers externos
- Si el user pide "agregar helpers globales", recordar que YA existen internos
- Sistema de alertas tiene fallback autom√°tico si showAlert() no existe (S20)
- Retry logic en inicializaci√≥n maneja currentUser as√≠ncrono (S02)

INTEGRACI√ìN:
- Requiere: currentUser.codeAlum (global)
- Opcional: showAlert(type, message) (global)
- Expone: window.LecturasModule (8 m√©todos p√∫blicos)
- Auto-init: 150ms delay para esperar currentUser
-->
<!-- MOD-099: FIN -->
